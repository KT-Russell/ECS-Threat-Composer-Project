"use strict";(self.webpackChunk_aws_threat_composer=self.webpackChunk_aws_threat_composer||[]).push([[6030],{"./src/components/generic/EntityMetadataEditor/index.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _cloudscape_design_components_expandable_section__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../node_modules/@cloudscape-design/components/expandable-section/index.js"),_cloudscape_design_components_grid__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../node_modules/@cloudscape-design/components/grid/index.js"),react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/react/index.js"),_styles_expandablePanelHeader__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/styles/expandablePanelHeader.ts"),_CommentsEdit__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/components/generic/CommentsEdit/index.tsx"),_emotion_react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const MetadataEditor=({variant,entity,onEditEntity,defaultExpanded})=>{const[expanded,setExpanded]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(defaultExpanded);return(0,_emotion_react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.Y)(_cloudscape_design_components_expandable_section__WEBPACK_IMPORTED_MODULE_4__.A,{headerText:(0,_emotion_react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.Y)("span",{css:_styles_expandablePanelHeader__WEBPACK_IMPORTED_MODULE_1__.A,children:"Metadata"}),headingTagOverride:"h3",variant,expanded,onChange:({detail})=>setExpanded(detail.expanded),children:(0,_emotion_react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.Y)(_cloudscape_design_components_grid__WEBPACK_IMPORTED_MODULE_5__.A,{gridDefinition:[{colspan:{default:12,xs:12}}],children:expanded&&(0,_emotion_react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.Y)(_CommentsEdit__WEBPACK_IMPORTED_MODULE_2__.A,{entity,onEditEntity})})})};MetadataEditor.displayName="MetadataEditor";const __WEBPACK_DEFAULT_EXPORT__=MetadataEditor;try{EntityMetadataEditor.displayName="EntityMetadataEditor",EntityMetadataEditor.__docgenInfo={description:"",displayName:"EntityMetadataEditor",props:{variant:{defaultValue:null,description:"",name:"variant",required:!0,type:{name:"enum",value:[{value:"undefined"},{value:'"default"'},{value:'"footer"'},{value:'"container"'},{value:'"stacked"'},{value:'"navigation"'},{value:'"inline"'}]}},entity:{defaultValue:null,description:"",name:"entity",required:!0,type:{name:'{ id: string; numericId: number; displayOrder?: number | undefined; metadata?: ({ key: "Comments"; value: string; } | { key: string; value: string | string[]; })[] | undefined; tags?: string[] | undefined; }'}},onEditEntity:{defaultValue:null,description:"",name:"onEditEntity",required:!0,type:{name:"(entity: T, key: string, value: string | string[] | undefined) => void"}},defaultExpanded:{defaultValue:null,description:"",name:"defaultExpanded",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/generic/EntityMetadataEditor/index.tsx#EntityMetadataEditor"]={docgenInfo:EntityMetadataEditor.__docgenInfo,name:"EntityMetadataEditor",path:"src/components/generic/EntityMetadataEditor/index.tsx#EntityMetadataEditor"})}catch(__react_docgen_typescript_loader_error){}},"./src/components/generic/GenericEntityCreationCard/index.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _cloudscape_design_components_button__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("../../node_modules/@cloudscape-design/components/button/index.js"),_cloudscape_design_components_column_layout__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("../../node_modules/@cloudscape-design/components/column-layout/index.js"),_cloudscape_design_components_space_between__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("../../node_modules/@cloudscape-design/components/space-between/index.js"),react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/react/index.js"),_configs__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/configs/index.ts"),_hooks_useEditMetadata__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/hooks/useEditMetadata/index.ts"),_utils_entityTag__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./src/utils/entityTag/index.tsx"),_generic_Textarea__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/components/generic/Textarea/index.tsx"),_EntityMetadataEditor__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./src/components/generic/EntityMetadataEditor/index.tsx"),_GenericCard__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./src/components/generic/GenericCard/index.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../node_modules/react/jsx-runtime.js");const GenericEntityCreationCard=(0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)((({editingEntity,setEditingEntity,header,onSave,onReset,customEditors,validateData},ref)=>{const containerRef=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null),textareaRef=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);(0,react__WEBPACK_IMPORTED_MODULE_0__.useImperativeHandle)(ref,(()=>({scrollIntoView:()=>{containerRef.current?.scrollIntoView({behavior:"smooth",block:"center"})},focusTextarea:()=>{setTimeout((()=>{textareaRef.current?.focus()}),300)}})));const handleAddTagToEntity=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((tag=>{const updated=(0,_utils_entityTag__WEBPACK_IMPORTED_MODULE_7__.q)(editingEntity,tag);setEditingEntity(updated)}),[editingEntity,setEditingEntity]),handleRemoveTagFromEntity=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((tag=>{const updated=(0,_utils_entityTag__WEBPACK_IMPORTED_MODULE_7__.A)(editingEntity,tag);setEditingEntity(updated)}),[editingEntity,setEditingEntity]),handleEditMetadata=(0,_hooks_useEditMetadata__WEBPACK_IMPORTED_MODULE_2__.A)(setEditingEntity);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{ref:containerRef,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_GenericCard__WEBPACK_IMPORTED_MODULE_5__.A,{header,tags:editingEntity?.tags,entityId:_configs__WEBPACK_IMPORTED_MODULE_1__.TN,onAddTagToEntity:(_entityId,tag)=>handleAddTagToEntity?.(tag),onRemoveTagFromEntity:(_entityId,tag)=>handleRemoveTagFromEntity?.(tag),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)(_cloudscape_design_components_space_between__WEBPACK_IMPORTED_MODULE_8__.A,{direction:"vertical",size:"s",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)(_cloudscape_design_components_space_between__WEBPACK_IMPORTED_MODULE_8__.A,{direction:"horizontal",size:"s",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_cloudscape_design_components_button__WEBPACK_IMPORTED_MODULE_9__.A,{onClick:onReset,children:"Reset"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_cloudscape_design_components_button__WEBPACK_IMPORTED_MODULE_9__.A,{variant:"primary",disabled:!editingEntity.content,onClick:onSave,children:"Save"})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)(_cloudscape_design_components_column_layout__WEBPACK_IMPORTED_MODULE_10__.A,{columns:customEditors?2:1,children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_generic_Textarea__WEBPACK_IMPORTED_MODULE_3__.A,{value:editingEntity.content,onChange:({detail})=>setEditingEntity({...editingEntity,content:detail.value}),validateData,singleLine:!0,ref:textareaRef}),customEditors]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_EntityMetadataEditor__WEBPACK_IMPORTED_MODULE_4__.A,{variant:"default",entity:editingEntity,onEditEntity:handleEditMetadata,defaultExpanded:!0})]})})})})),__WEBPACK_DEFAULT_EXPORT__=GenericEntityCreationCard;try{GenericEntityCreationCard.displayName="GenericEntityCreationCard",GenericEntityCreationCard.__docgenInfo={description:"",displayName:"GenericEntityCreationCard",props:{editingEntity:{defaultValue:null,description:"",name:"editingEntity",required:!0,type:{name:'{ id: string; numericId: number; content: string; displayOrder?: number | undefined; metadata?: ({ key: "Comments"; value: string; } | { key: string; value: string | string[]; })[] | undefined; tags?: string[] | undefined; }'}},setEditingEntity:{defaultValue:null,description:"",name:"setEditingEntity",required:!0,type:{name:'Dispatch<SetStateAction<{ id: string; numericId: number; content: string; displayOrder?: number | undefined; metadata?: ({ key: "Comments"; value: string; } | { key: string; value: string | string[]; })[] | undefined; tags?: string[] | undefined; }>>'}},header:{defaultValue:null,description:"",name:"header",required:!0,type:{name:"string"}},onSave:{defaultValue:null,description:"",name:"onSave",required:!1,type:{name:"(() => void)"}},onReset:{defaultValue:null,description:"",name:"onReset",required:!1,type:{name:"(() => void)"}},customEditors:{defaultValue:null,description:"",name:"customEditors",required:!1,type:{name:"ReactNode"}},validateData:{defaultValue:null,description:"",name:"validateData",required:!1,type:{name:"((newValue: string) => ZodSafeParseResult<string>)"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/generic/GenericEntityCreationCard/index.tsx#GenericEntityCreationCard"]={docgenInfo:GenericEntityCreationCard.__docgenInfo,name:"GenericEntityCreationCard",path:"src/components/generic/GenericEntityCreationCard/index.tsx#GenericEntityCreationCard"})}catch(__react_docgen_typescript_loader_error){}},"./src/components/generic/Textarea/index.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _cloudscape_design_components_form_field__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../node_modules/@cloudscape-design/components/form-field/index.js"),_cloudscape_design_components_textarea__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../node_modules/@cloudscape-design/components/textarea/index.js"),react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/react/index.js"),_hooks_useContentValidation__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/hooks/useContentValidation/index.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/react/jsx-runtime.js");const Textarea=react__WEBPACK_IMPORTED_MODULE_0__.forwardRef((({value,onChange,validateData,singleLine,...props},ref)=>{const{tempValue,errorText,handleChange}=(0,_hooks_useContentValidation__WEBPACK_IMPORTED_MODULE_1__.A)(value,onChange,validateData),handleValueChange=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((event=>handleChange(singleLine?{...event,detail:{...event.detail,value:event.detail.value.replace(/\n|\r/i," ")}}:event)),[singleLine,handleChange]);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_cloudscape_design_components_form_field__WEBPACK_IMPORTED_MODULE_3__.A,{...props,errorText,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_cloudscape_design_components_textarea__WEBPACK_IMPORTED_MODULE_4__.A,{...props,ref,value:tempValue,onChange:handleValueChange})})})),__WEBPACK_DEFAULT_EXPORT__=Textarea;try{Textarea.displayName="Textarea",Textarea.__docgenInfo={description:"",displayName:"Textarea",props:{ref:{defaultValue:null,description:"",name:"ref",required:!1,type:{name:"LegacyRef<any>"}},validateData:{defaultValue:null,description:"",name:"validateData",required:!1,type:{name:"((newValue: string) => ZodSafeParseResult<string>)"}},singleLine:{defaultValue:null,description:"",name:"singleLine",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/generic/Textarea/index.tsx#Textarea"]={docgenInfo:Textarea.__docgenInfo,name:"Textarea",path:"src/components/generic/Textarea/index.tsx#Textarea"})}catch(__react_docgen_typescript_loader_error){}},"./src/components/threats/ThreatLinkView/index.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _cloudscape_design_components_autosuggest__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../node_modules/@cloudscape-design/components/autosuggest/index.js"),_cloudscape_design_components_expandable_section__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/@cloudscape-design/components/expandable-section/index.js"),_cloudscape_design_components_token_group__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../node_modules/@cloudscape-design/components/token-group/index.js"),react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/react/index.js"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/react/jsx-runtime.js");const ThreatLinkComponent=({linkedThreatIds,threatList,onAddThreatLink,onRemoveThreatLink})=>{const[searchValue,setSearchValue]=react__WEBPACK_IMPORTED_MODULE_0__.useState(""),linkedThreats=(0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)((()=>threatList.filter((al=>linkedThreatIds.includes(al.id)))),[linkedThreatIds,threatList]),filteredThreats=(0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)((()=>{const threats=threatList.filter((x=>!linkedThreatIds.includes(x.id)));return searchValue?threats.filter((x=>x.statement&&x.statement.toLowerCase().indexOf(searchValue.toLowerCase())>=0)):threats}),[searchValue,threatList,linkedThreatIds]);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsxs)(_cloudscape_design_components_expandable_section__WEBPACK_IMPORTED_MODULE_2__.A,{headerText:`Linked threats (${linkedThreats.length})`,children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_cloudscape_design_components_autosuggest__WEBPACK_IMPORTED_MODULE_3__.A,{onChange:({detail})=>setSearchValue(detail.value),value:searchValue,options:filteredThreats.map((x=>({value:x.id,label:x.statement}))),onSelect:({detail})=>{onAddThreatLink(detail.value),setSearchValue("")},filteringType:"manual",enteredTextLabel:value=>`Use: "${value}"`,placeholder:"Search threat",empty:"No matches found"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("div",{style:{display:"flex"},children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_cloudscape_design_components_token_group__WEBPACK_IMPORTED_MODULE_4__.A,{items:linkedThreats.map((x=>({label:x.statement,dismissLabel:`Unlink threat ${x.numericId}`}))),onDismiss:({detail:{itemIndex}})=>{onRemoveThreatLink(linkedThreats[itemIndex].id)}})})]})};ThreatLinkComponent.displayName="ThreatLinkComponent";const __WEBPACK_DEFAULT_EXPORT__=ThreatLinkComponent;try{ThreatLinkView.displayName="ThreatLinkView",ThreatLinkView.__docgenInfo={description:"",displayName:"ThreatLinkView",props:{linkedThreatIds:{defaultValue:null,description:"",name:"linkedThreatIds",required:!0,type:{name:"string[]"}},threatList:{defaultValue:null,description:"",name:"threatList",required:!0,type:{name:"{ id: string; numericId: number; displayOrder?: number | undefined; tags?: string[] | undefined; threatSource?: string | undefined; prerequisites?: string | undefined; threatAction?: string | undefined; ... 7 more ...; status?: string | undefined; }[]"}},onAddThreatLink:{defaultValue:null,description:"",name:"onAddThreatLink",required:!0,type:{name:"(threatId: string) => void"}},onRemoveThreatLink:{defaultValue:null,description:"",name:"onRemoveThreatLink",required:!0,type:{name:"(threatId: string) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/threats/ThreatLinkView/index.tsx#ThreatLinkView"]={docgenInfo:ThreatLinkView.__docgenInfo,name:"ThreatLinkView",path:"src/components/threats/ThreatLinkView/index.tsx#ThreatLinkView"})}catch(__react_docgen_typescript_loader_error){}},"./src/containers/MitigationList/index.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>index_stories});var react=__webpack_require__("../../node_modules/react/index.js"),components_button=__webpack_require__("../../node_modules/@cloudscape-design/components/button/index.js"),container=__webpack_require__("../../node_modules/@cloudscape-design/components/container/index.js"),grid=__webpack_require__("../../node_modules/@cloudscape-design/components/grid/index.js"),multiselect=__webpack_require__("../../node_modules/@cloudscape-design/components/multiselect/index.js"),space_between=__webpack_require__("../../node_modules/@cloudscape-design/components/space-between/index.js"),text_filter=__webpack_require__("../../node_modules/@cloudscape-design/components/text-filter/index.js"),configs=__webpack_require__("./src/configs/index.ts"),contexts=__webpack_require__("./src/contexts/index.ts"),context=__webpack_require__("./src/contexts/MitigationsContext/context.ts"),mitigationStatus=__webpack_require__("./src/data/status/mitigationStatus.json"),ContentLayout=__webpack_require__("./src/components/generic/ContentLayout/index.tsx"),LinkedEntityFilter=__webpack_require__("./src/components/generic/LinkedEntityFilter/index.tsx"),TagSelector=__webpack_require__("./src/components/generic/TagSelector/index.tsx"),column_layout=__webpack_require__("../../node_modules/@cloudscape-design/components/column-layout/index.js"),text_content=__webpack_require__("../../node_modules/@cloudscape-design/components/text-content/index.js"),configs_status=__webpack_require__("./src/configs/status.ts"),customTypes=__webpack_require__("./src/customTypes/index.ts"),useEditMetadata=__webpack_require__("./src/hooks/useEditMetadata/index.ts"),AssumptionLink=__webpack_require__("./src/components/assumptions/AssumptionLink/index.tsx"),CopyToClipboard=__webpack_require__("./src/components/generic/CopyToClipboard/index.tsx"),EntityMetadataEditor=__webpack_require__("./src/components/generic/EntityMetadataEditor/index.tsx"),GenericCard=__webpack_require__("./src/components/generic/GenericCard/index.tsx"),StatusBadge=__webpack_require__("./src/components/generic/StatusBadge/index.tsx"),Textarea=__webpack_require__("./src/components/generic/Textarea/index.tsx"),MitigationLinksContext_context=__webpack_require__("./src/contexts/MitigationLinksContext/context.ts"),ThreatsContext_context=__webpack_require__("./src/contexts/ThreatsContext/context.ts"),ThreatLinkView=__webpack_require__("./src/components/threats/ThreatLinkView/index.tsx"),jsx_runtime=__webpack_require__("../../node_modules/react/jsx-runtime.js");const MitigationThreatLinkComponent=({mitigationId})=>{const{statementList}=(0,ThreatsContext_context.YN)(),[mitigationLinks,setMitigationLinks]=(0,react.useState)([]),{getMitigtaionThreatLinks}=(0,MitigationLinksContext_context.$)();(0,react.useEffect)((()=>{const _mitigationLinks=getMitigtaionThreatLinks(mitigationId);setMitigationLinks(_mitigationLinks||[])}),[getMitigtaionThreatLinks,mitigationId]);const{addMitigationLink,removeMitigationLink}=(0,MitigationLinksContext_context.$)();return(0,jsx_runtime.jsx)(ThreatLinkView.A,{threatList:statementList,linkedThreatIds:mitigationLinks.map((ml=>ml.linkedId)),onAddThreatLink:threatId=>addMitigationLink({linkedId:threatId,mitigationId}),onRemoveThreatLink:threatId=>removeMitigationLink(mitigationId,threatId)})};MitigationThreatLinkComponent.displayName="MitigationThreatLinkComponent";const mitigations_MitigationThreatLink=MitigationThreatLinkComponent;try{MitigationThreatLink.displayName="MitigationThreatLink",MitigationThreatLink.__docgenInfo={description:"",displayName:"MitigationThreatLink",props:{mitigationId:{defaultValue:null,description:"",name:"mitigationId",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/mitigations/MitigationThreatLink/index.tsx#MitigationThreatLink"]={docgenInfo:MitigationThreatLink.__docgenInfo,name:"MitigationThreatLink",path:"src/components/mitigations/MitigationThreatLink/index.tsx#MitigationThreatLink"})}catch(__react_docgen_typescript_loader_error){}const MitigationCard=({entity,onCopy,onRemove,onEdit,onAddTagToEntity,onRemoveTagFromEntity})=>{const[editingMode,setEditingMode]=(0,react.useState)(!1),[editingValue,setEditingValue]=(0,react.useState)(entity.content),handleSave=(0,react.useCallback)((()=>{const updated={...entity,content:editingValue};onEdit?.(updated),setEditingMode(!1)}),[editingValue,entity,onEdit]),handleCancel=(0,react.useCallback)((()=>{setEditingValue(entity.content),setEditingMode(!1)}),[entity]),handleMetadataEdit=(0,useEditMetadata.A)(onEdit);return(0,jsx_runtime.jsx)(GenericCard.A,{header:`Mitigation ${entity.numericId}`,entityId:entity.id,tags:entity.tags,onCopy:()=>onCopy?.(entity.id),onRemove:()=>onRemove?.(entity.id),onEdit:()=>setEditingMode(!0),info:(0,jsx_runtime.jsx)(StatusBadge.A,{options:mitigationStatus,selectedOption:entity.status,setSelectedOption:option=>onEdit?.({...entity,status:option}),statusColorMapping:configs_status.Wu}),onAddTagToEntity:(_entityId,tag)=>onAddTagToEntity?.(entity,tag),onRemoveTagFromEntity:(_entityId,tag)=>onRemoveTagFromEntity?.(entity,tag),children:(0,jsx_runtime.jsxs)(space_between.A,{direction:"vertical",size:"s",children:[(0,jsx_runtime.jsxs)(column_layout.A,{columns:2,children:[editingMode?(0,jsx_runtime.jsxs)(space_between.A,{direction:"vertical",size:"s",children:[(0,jsx_runtime.jsx)(Textarea.A,{value:editingValue,onChange:({detail})=>setEditingValue(detail.value),validateData:customTypes.F0.shape.content.safeParse,singleLine:!0}),(0,jsx_runtime.jsxs)(space_between.A,{direction:"horizontal",size:"s",children:[(0,jsx_runtime.jsx)(components_button.A,{onClick:handleCancel,children:"Cancel"}),(0,jsx_runtime.jsx)(components_button.A,{variant:"primary",onClick:handleSave,children:"Save"})]})]}):(0,jsx_runtime.jsx)(text_content.A,{children:(0,jsx_runtime.jsx)(CopyToClipboard.A,{children:entity.content||""})}),(0,jsx_runtime.jsxs)(space_between.A,{direction:"vertical",size:"s",children:[(0,jsx_runtime.jsx)(mitigations_MitigationThreatLink,{mitigationId:entity.id}),(0,jsx_runtime.jsx)(AssumptionLink.A,{linkedEntityId:entity.id,type:"Mitigation"})]})]}),(0,jsx_runtime.jsx)(EntityMetadataEditor.A,{variant:"default",entity,onEditEntity:handleMetadataEdit})]})})};MitigationCard.displayName="MitigationCard";const mitigations_MitigationCard=MitigationCard;try{MitigationCard.displayName="MitigationCard",MitigationCard.__docgenInfo={description:"",displayName:"MitigationCard",props:{entity:{defaultValue:null,description:"",name:"entity",required:!0,type:{name:'{ id: string; numericId: number; content: string; displayOrder?: number | undefined; tags?: string[] | undefined; metadata?: ({ key: "Comments"; value: string; } | { key: string; value: string | string[]; } | { ...; } | { ...; } | { ...; })[] | undefined; status?: string | undefined; }'}},onCopy:{defaultValue:null,description:"",name:"onCopy",required:!1,type:{name:"((id: string) => void)"}},onRemove:{defaultValue:null,description:"",name:"onRemove",required:!1,type:{name:"((id: string) => void)"}},onEdit:{defaultValue:null,description:"",name:"onEdit",required:!1,type:{name:'((entity: { id: string; numericId: number; content: string; displayOrder?: number; tags?: string[]; metadata?: ({ key: "Comments"; value: string; } | { key: string; value: string | string[]; } | { ...; } | { ...; } | { ...; })[] | undefined; status?: string | undefined; }) => void) | undefined'}},onAddTagToEntity:{defaultValue:null,description:"",name:"onAddTagToEntity",required:!1,type:{name:'((entity: { id: string; numericId: number; content: string; displayOrder?: number; tags?: string[]; metadata?: ({ key: "Comments"; value: string; } | { key: string; value: string | string[]; } | { ...; } | { ...; } | { ...; })[] | undefined; status?: string | undefined; }, tag: string) => voi...'}},onRemoveTagFromEntity:{defaultValue:null,description:"",name:"onRemoveTagFromEntity",required:!1,type:{name:'((entity: { id: string; numericId: number; content: string; displayOrder?: number; tags?: string[]; metadata?: ({ key: "Comments"; value: string; } | { key: string; value: string | string[]; } | { ...; } | { ...; } | { ...; })[] | undefined; status?: string | undefined; }, tag: string) => voi...'}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/mitigations/MitigationCard/index.tsx#MitigationCard"]={docgenInfo:MitigationCard.__docgenInfo,name:"MitigationCard",path:"src/components/mitigations/MitigationCard/index.tsx#MitigationCard"})}catch(__react_docgen_typescript_loader_error){}var AssumptionsContext_context=__webpack_require__("./src/contexts/AssumptionsContext/context.ts"),getNewMitigation=__webpack_require__("./src/utils/getNewMitigation/index.tsx"),AssumptionLinkView=__webpack_require__("./src/components/assumptions/AssumptionLinkView/index.tsx"),GenericEntityCreationCard=__webpack_require__("./src/components/generic/GenericEntityCreationCard/index.tsx");const MitigationCreationCard=(0,react.forwardRef)((({onSave},ref)=>{const[editingEntity,setEditingEntity]=(0,react.useState)((0,getNewMitigation.A)()),[linkedAssumptionIds,setLinkedAssumptionIds]=(0,react.useState)([]),[linkedThreatIds,setLinkedThreatIds]=(0,react.useState)([]),{assumptionList,saveAssumption}=(0,AssumptionsContext_context.d)(),{statementList}=(0,ThreatsContext_context.YN)(),handleSave=(0,react.useCallback)((()=>{onSave?.(editingEntity,linkedAssumptionIds,linkedThreatIds),setEditingEntity((0,getNewMitigation.A)()),setLinkedAssumptionIds([]),setLinkedThreatIds([])}),[editingEntity,linkedAssumptionIds,linkedThreatIds]),handleReset=(0,react.useCallback)((()=>{setEditingEntity((0,getNewMitigation.A)()),setLinkedAssumptionIds([]),setLinkedThreatIds([])}),[]),handleAddAssumptionLink=(0,react.useCallback)((assumptionIdOrNewAssumption=>{if(assumptionList.find((a=>a.id===assumptionIdOrNewAssumption)))setLinkedAssumptionIds((prev=>[...prev,assumptionIdOrNewAssumption]));else{const newAssumption=saveAssumption({numericId:-1,content:assumptionIdOrNewAssumption,id:configs.TN});setLinkedAssumptionIds((prev=>[...prev,newAssumption.id]))}}),[assumptionList,saveAssumption,setLinkedAssumptionIds]);return(0,jsx_runtime.jsx)(GenericEntityCreationCard.A,{ref,editingEntity,setEditingEntity,header:"Add new mitigation",onSave:handleSave,onReset:handleReset,validateData:customTypes.F0.shape.content.safeParse,customEditors:(0,jsx_runtime.jsxs)(space_between.A,{direction:"vertical",size:"s",children:[(0,jsx_runtime.jsx)(ThreatLinkView.A,{linkedThreatIds,threatList:statementList,onAddThreatLink:id=>setLinkedThreatIds((prev=>[...prev,id])),onRemoveThreatLink:id=>setLinkedThreatIds((prev=>prev.filter((p=>p!==id))))}),(0,jsx_runtime.jsx)(AssumptionLinkView.A,{linkedAssumptionIds,assumptionList,onAddAssumptionLink:handleAddAssumptionLink,onRemoveAssumptionLink:id=>setLinkedAssumptionIds((prev=>prev.filter((p=>p!==id))))})]})})})),mitigations_MitigationCreationCard=MitigationCreationCard;try{MitigationCreationCard.displayName="MitigationCreationCard",MitigationCreationCard.__docgenInfo={description:"",displayName:"MitigationCreationCard",props:{onSave:{defaultValue:null,description:"",name:"onSave",required:!1,type:{name:'((entity: { id: string; numericId: number; content: string; displayOrder?: number; tags?: string[]; metadata?: ({ key: "Comments"; value: string; } | { key: string; value: string | string[]; } | { ...; } | { ...; } | { ...; })[] | undefined; status?: string | undefined; }, linkedAssumptionIds...'}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/mitigations/MitigationCreationCard/index.tsx#MitigationCreationCard"]={docgenInfo:MitigationCreationCard.__docgenInfo,name:"MitigationCreationCard",path:"src/components/mitigations/MitigationCreationCard/index.tsx#MitigationCreationCard"})}catch(__react_docgen_typescript_loader_error){}const ALL_STATUS=[...mitigationStatus.map((ia=>({label:ia.label,value:ia.value}))),{label:"Not Set",value:configs.gK}],MitigationList=({initialFilter})=>{const{mitigationList,removeMitigation,saveMitigation}=(0,context.R)(),{addMitigationLinks,mitigationLinkList,removeMitigationLinksByMitigationId}=(0,contexts.$g)(),{addAssumptionLinks,assumptionLinkList,removeAssumptionLinksByLinkedEntityId}=(0,contexts.NN)(),[filteringText,setFilteringText]=(0,react.useState)(""),[selectedTags,setSelectedTags]=(0,react.useState)([]),[selectedStatus,setSelectedStatus]=(0,react.useState)(initialFilter?.status||[]),[selectedLinkedThreatsFilter,setSelectedLinkedThreatsFilter]=(0,react.useState)(LinkedEntityFilter.y2),[selectedLinkedAssumptionsFilter,setSelectedLinkedAssumptionsFilter]=(0,react.useState)(LinkedEntityFilter.y2),handleRemove=(0,react.useCallback)((async mitigationId=>{removeMitigation(mitigationId),await removeAssumptionLinksByLinkedEntityId(mitigationId),await removeMitigationLinksByMitigationId(mitigationId)}),[removeAssumptionLinksByLinkedEntityId,removeMitigation,removeMitigationLinksByMitigationId]),hasNoFilter=(0,react.useMemo)((()=>""===filteringText&&selectedLinkedAssumptionsFilter===LinkedEntityFilter.y2&&selectedLinkedThreatsFilter===LinkedEntityFilter.y2&&0===selectedTags.length&&0===selectedStatus.length),[filteringText,selectedTags,selectedStatus,selectedLinkedThreatsFilter,selectedLinkedAssumptionsFilter]),handleClearFilter=(0,react.useCallback)((()=>{setFilteringText(""),setSelectedTags([]),setSelectedStatus([]),setSelectedLinkedAssumptionsFilter(LinkedEntityFilter.y2),setSelectedLinkedThreatsFilter(LinkedEntityFilter.y2)}),[]),allTags=(0,react.useMemo)((()=>mitigationList.reduce(((all,cur)=>[...all,...cur.tags?.filter((ia=>!all.includes(ia)))||[]]),[])),[mitigationList]),handleAddTagToEntity=(0,react.useCallback)(((mitigation,tag)=>{const updated={...mitigation,tags:mitigation.tags?mitigation.tags.includes(tag)?mitigation.tags:[...mitigation.tags,tag]:[tag]};saveMitigation(updated)}),[saveMitigation]),handleRemoveTagFromEntity=(0,react.useCallback)(((mitigation,tag)=>{const updated={...mitigation,tags:mitigation.tags?.filter((t=>t!==tag))};saveMitigation(updated)}),[saveMitigation]),filteredList=(0,react.useMemo)((()=>{let output=mitigationList;return filteringText&&(output=output.filter((st=>st.content&&st.content.toLowerCase().indexOf(filteringText.toLowerCase())>=0))),selectedTags&&selectedTags.length>0&&(output=output.filter((st=>st.tags?.some((t=>selectedTags.includes(t)))))),selectedStatus&&selectedStatus.length>0&&(output=output.filter((st=>st.status?selectedStatus.includes(st.status):selectedStatus.includes(configs.gK)))),selectedLinkedThreatsFilter!==LinkedEntityFilter.y2&&(output=output.filter((st=>mitigationLinkList.some((ml=>ml.mitigationId===st.id))?selectedLinkedThreatsFilter===LinkedEntityFilter.Nf:selectedLinkedThreatsFilter===LinkedEntityFilter.D$))),selectedLinkedAssumptionsFilter!==LinkedEntityFilter.y2&&(output=output.filter((st=>assumptionLinkList.some((al=>al.linkedId===st.id))?selectedLinkedAssumptionsFilter===LinkedEntityFilter.Nf:selectedLinkedAssumptionsFilter===LinkedEntityFilter.D$))),output=output.sort(((op1,op2)=>(op2.displayOrder||Number.MAX_VALUE)-(op1.displayOrder||Number.MAX_VALUE))),output}),[filteringText,mitigationList,selectedTags,selectedStatus,assumptionLinkList,mitigationLinkList,selectedLinkedAssumptionsFilter,selectedLinkedThreatsFilter]),handleSaveNew=(0,react.useCallback)(((mitigation,linkedAssumptionIds,linkedThreatIds)=>{const updated=saveMitigation(mitigation),mitigationLinks=[];linkedThreatIds.forEach((id=>{mitigationLinks.push({linkedId:id,mitigationId:updated.id})})),addMitigationLinks(mitigationLinks);const assumptionLinks=[];linkedAssumptionIds.forEach((id=>{assumptionLinks.push({linkedId:updated.id,assumptionId:id,type:"Mitigation"})})),addAssumptionLinks(assumptionLinks)}),[saveMitigation,addMitigationLinks,addAssumptionLinks]),mitigationCreationCardRef=(0,react.useRef)(null),handleAddNewMitigation=(0,react.useCallback)((()=>{mitigationCreationCardRef.current?.scrollIntoView(),mitigationCreationCardRef.current?.focusTextarea()}),[]),actions=(0,react.useMemo)((()=>(0,jsx_runtime.jsx)(components_button.A,{variant:"primary",onClick:handleAddNewMitigation,children:"Add new mitigation"})),[handleAddNewMitigation]);return(0,jsx_runtime.jsx)(ContentLayout.A,{title:"Mitigations",counter:`(${filteredList.length})`,actions,children:(0,jsx_runtime.jsxs)(space_between.A,{direction:"vertical",size:"s",children:[(0,jsx_runtime.jsx)(container.A,{children:(0,jsx_runtime.jsxs)(space_between.A,{direction:"vertical",size:"s",children:[(0,jsx_runtime.jsx)(text_filter.A,{filteringText,filteringPlaceholder:"Find mitigations",filteringAriaLabel:"Filter mitigations",onChange:({detail})=>setFilteringText(detail.filteringText)}),(0,jsx_runtime.jsxs)(grid.A,{gridDefinition:[{colspan:{default:12,xs:5}},{colspan:{default:12,xs:5}},{colspan:{default:12,xs:4}},{colspan:{default:12,xs:4}},{colspan:{default:3}}],children:[(0,jsx_runtime.jsx)(TagSelector.A,{allTags,selectedTags,setSelectedTags}),(0,jsx_runtime.jsx)(multiselect.A,{tokenLimit:0,selectedOptions:ALL_STATUS.filter((x=>selectedStatus.includes(x.value))),onChange:({detail})=>setSelectedStatus(detail.selectedOptions?.map((o=>o.value||""))||[]),deselectAriaLabel:e=>`Remove ${e.label}`,options:ALL_STATUS,placeholder:"Filtered by status",selectedAriaLabel:"Selected"}),(0,jsx_runtime.jsx)(LinkedEntityFilter.Ay,{label:"Linked threats",entityDisplayName:"threats",selected:selectedLinkedThreatsFilter,setSelected:setSelectedLinkedThreatsFilter}),(0,jsx_runtime.jsx)(LinkedEntityFilter.Ay,{label:"Linked assumptions",entityDisplayName:"assumptions",selected:selectedLinkedAssumptionsFilter,setSelected:setSelectedLinkedAssumptionsFilter}),(0,jsx_runtime.jsx)(components_button.A,{onClick:handleClearFilter,disabled:hasNoFilter,children:"Clear filters"})]})]})}),filteredList?.map((entity=>(0,jsx_runtime.jsx)(mitigations_MitigationCard,{entity,onRemove:handleRemove,onEdit:saveMitigation,onAddTagToEntity:handleAddTagToEntity,onRemoveTagFromEntity:handleRemoveTagFromEntity},entity.id))),(0,jsx_runtime.jsx)(mitigations_MitigationCreationCard,{ref:mitigationCreationCardRef,onSave:handleSaveNew})]})})};MitigationList.displayName="MitigationList";const mitigations_MitigationList=MitigationList;try{MitigationList.displayName="MitigationList",MitigationList.__docgenInfo={description:"",displayName:"MitigationList",props:{initialFilter:{defaultValue:null,description:"",name:"initialFilter",required:!1,type:{name:"MitigationListFilter"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/mitigations/MitigationList/index.tsx#MitigationList"]={docgenInfo:MitigationList.__docgenInfo,name:"MitigationList",path:"src/components/mitigations/MitigationList/index.tsx#MitigationList"})}catch(__react_docgen_typescript_loader_error){}var WorkspaceContextAggregator=__webpack_require__("./src/contexts/WorkspaceContextAggregator/index.tsx");const MitigationList_MitigationList=({workspaceId})=>(0,jsx_runtime.jsx)(WorkspaceContextAggregator.A,{requiredGlobalSetupContext:!0,workspaceId:workspaceId||null,composerMode:"Full",children:(0,jsx_runtime.jsx)(mitigations_MitigationList,{})});MitigationList_MitigationList.displayName="MitigationList";const containers_MitigationList=MitigationList_MitigationList;try{MitigationList_MitigationList.displayName="MitigationList",MitigationList_MitigationList.__docgenInfo={description:"",displayName:"MitigationList",props:{workspaceId:{defaultValue:null,description:"",name:"workspaceId",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/containers/MitigationList/index.tsx#MitigationList"]={docgenInfo:MitigationList_MitigationList.__docgenInfo,name:"MitigationList",path:"src/containers/MitigationList/index.tsx#MitigationList"})}catch(__react_docgen_typescript_loader_error){}const index_stories={title:"fullMode/MitigationList",component:containers_MitigationList},Default={};Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:"{}",...Default.parameters?.docs?.source}}};const __namedExportsOrder=["Default"]}}]);