"use strict";(self.webpackChunk_aws_threat_composer=self.webpackChunk_aws_threat_composer||[]).push([[2785],{"./src/components/generic/FileUpload/index.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>generic_FileUpload});var components_button=__webpack_require__("../../node_modules/@cloudscape-design/components/button/index.js"),form_field=__webpack_require__("../../node_modules/@cloudscape-design/components/form-field/index.js"),space_between=__webpack_require__("../../node_modules/@cloudscape-design/components/space-between/index.js"),react=__webpack_require__("../../node_modules/react/index.js"),status_indicator=__webpack_require__("../../node_modules/@cloudscape-design/components/status-indicator/index.js"),text_content=__webpack_require__("../../node_modules/@cloudscape-design/components/text-content/index.js");const utils_getDisplayLastModified=lastModified=>`Last modified: ${new Date(lastModified).toLocaleString()}`,utils_getDisplaySize=size=>{if(!size)return;const i=Math.floor(Math.log(size)/Math.log(1e3));return`${parseFloat((size/Math.pow(1e3,i)).toFixed(2))} ${["bytes","KB","MB","GB"][i]}`};var jsx_runtime=__webpack_require__("../../node_modules/react/jsx-runtime.js");const FileTokenLabel=({name,size,lastModified})=>(0,jsx_runtime.jsxs)(space_between.A,{direction:"horizontal",size:"xs",children:[(0,jsx_runtime.jsx)(status_indicator.A,{type:"success"}),(0,jsx_runtime.jsx)(text_content.A,{children:(0,jsx_runtime.jsxs)(space_between.A,{direction:"vertical",size:"xxxs",children:[(0,jsx_runtime.jsx)("span",{children:(0,jsx_runtime.jsx)("b",{children:name})},"name"),(0,jsx_runtime.jsxs)("span",{children:["Size: ",utils_getDisplaySize(size)]},"size"),lastModified&&(0,jsx_runtime.jsx)("span",{children:utils_getDisplayLastModified(lastModified)},"lastModified")]})})]});FileTokenLabel.displayName="FileTokenLabel";const components_FileTokenLabel=FileTokenLabel;try{FileTokenLabel.displayName="FileTokenLabel",FileTokenLabel.__docgenInfo={description:"",displayName:"FileTokenLabel",props:{name:{defaultValue:null,description:"",name:"name",required:!1,type:{name:"string"}},size:{defaultValue:null,description:"",name:"size",required:!1,type:{name:"number"}},lastModified:{defaultValue:null,description:"",name:"lastModified",required:!1,type:{name:"number"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/generic/FileUpload/components/FileTokenLabel/index.tsx#FileTokenLabel"]={docgenInfo:FileTokenLabel.__docgenInfo,name:"FileTokenLabel",path:"src/components/generic/FileUpload/components/FileTokenLabel/index.tsx#FileTokenLabel"})}catch(__react_docgen_typescript_loader_error){}const FileUpload=({controlId,label,description,constraintText,secondaryControl,info,buttonText="Choose file",name,accept,files,sizeLimit,onChange,...props})=>{const inputElement=(0,react.useRef)(null),[errorText,setErrorText]=(0,react.useState)(props.errorText);(0,react.useEffect)((()=>{setErrorText(props.errorText)}),[props.errorText]);const footer=(0,react.useMemo)((()=>files&&0!==files.length?(0,jsx_runtime.jsx)(components_FileTokenLabel,{name:files[0].name,lastModified:files[0].lastModified,size:files[0].size}):null),[files]),handleFileSelectionButtonClick=(0,react.useCallback)((()=>{inputElement.current?.click()}),[]),handleFileSelectionChange=(0,react.useCallback)((event=>{const newFiles=[];if(setErrorText(void 0),event.target.files){const targetFiles=event.target.files,len=targetFiles.length;for(let i=0;i<len;i++){const file=targetFiles.item(i);if(file){if(sizeLimit&&file.size>sizeLimit){setErrorText(`File ${file.name} exceeds maximum file size limit: ${utils_getDisplaySize(sizeLimit)}`);break}newFiles.push(file)}}}onChange?.(newFiles)}),[files,onChange]);return(0,jsx_runtime.jsxs)(space_between.A,{direction:"vertical",size:"m",children:[(0,jsx_runtime.jsxs)(form_field.A,{...props,label,info,description,constraintText,secondaryControl,errorText,children:[(0,jsx_runtime.jsx)("input",{ref:inputElement,name,style:{display:"none"},type:"file",accept,onChange:handleFileSelectionChange}),(0,jsx_runtime.jsx)(components_button.A,{iconName:"upload",onClick:handleFileSelectionButtonClick,children:buttonText})]}),footer]})};FileUpload.displayName="FileUpload";const generic_FileUpload=FileUpload;try{FileUpload.displayName="FileUpload",FileUpload.__docgenInfo={description:"",displayName:"FileUpload",props:{accept:{defaultValue:null,description:"",name:"accept",required:!1,type:{name:"string"}},sizeLimit:{defaultValue:null,description:"",name:"sizeLimit",required:!1,type:{name:"number"}},buttonText:{defaultValue:{value:"Choose file"},description:"",name:"buttonText",required:!1,type:{name:"string"}},name:{defaultValue:null,description:"",name:"name",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!1,type:{name:"((files: File[]) => void)"}},files:{defaultValue:null,description:"",name:"files",required:!1,type:{name:"File[]"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/generic/FileUpload/index.tsx#FileUpload"]={docgenInfo:FileUpload.__docgenInfo,name:"FileUpload",path:"src/components/generic/FileUpload/index.tsx#FileUpload"})}catch(__react_docgen_typescript_loader_error){}},"./src/components/threats/ThreatStatementList/index.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>threats_ThreatStatementList});var components_button=__webpack_require__("../../node_modules/@cloudscape-design/components/button/index.js"),container=__webpack_require__("../../node_modules/@cloudscape-design/components/container/index.js"),grid=__webpack_require__("../../node_modules/@cloudscape-design/components/grid/index.js"),header=__webpack_require__("../../node_modules/@cloudscape-design/components/header/index.js"),multiselect=__webpack_require__("../../node_modules/@cloudscape-design/components/multiselect/index.js"),space_between=__webpack_require__("../../node_modules/@cloudscape-design/components/space-between/index.js"),text_filter=__webpack_require__("../../node_modules/@cloudscape-design/components/text-filter/index.js"),emotion_react_browser_esm=__webpack_require__("../../node_modules/@emotion/react/dist/emotion-react.browser.esm.js"),react=__webpack_require__("../../node_modules/react/index.js"),configs=__webpack_require__("./src/configs/index.ts"),contexts=__webpack_require__("./src/contexts/index.ts"),context=__webpack_require__("./src/contexts/GlobalSetupContext/context.ts"),ThreatsContext_context=__webpack_require__("./src/contexts/ThreatsContext/context.ts"),threatStatus=__webpack_require__("./src/data/status/threatStatus.json"),useEditMetadata=__webpack_require__("./src/hooks/useEditMetadata/index.ts"),entityTag=__webpack_require__("./src/utils/entityTag/index.tsx"),jsx_runtime=__webpack_require__("../../node_modules/react/jsx-runtime.js");const AssetSelector=({allAssets,selectedAssets,setSelectedAssets})=>{const sortedAssets=(0,react.useMemo)((()=>allAssets.sort(((a,b)=>a.toLowerCase().localeCompare(b.toLowerCase())))),[allAssets]);return(0,jsx_runtime.jsx)(multiselect.A,{tokenLimit:0,selectedOptions:selectedAssets.map((ia=>({label:ia,value:ia}))),onChange:({detail})=>setSelectedAssets(detail.selectedOptions?.map((o=>o.value||""))||[]),deselectAriaLabel:e=>`Remove ${e.label}`,options:sortedAssets.map((g=>({label:g,value:g}))),filteringType:"auto",placeholder:"Filtered by Assets",selectedAriaLabel:"Selected"})};AssetSelector.displayName="AssetSelector";const generic_AssetSelector=AssetSelector;try{AssetSelector.displayName="AssetSelector",AssetSelector.__docgenInfo={description:"",displayName:"AssetSelector",props:{allAssets:{defaultValue:null,description:"",name:"allAssets",required:!0,type:{name:"string[]"}},selectedAssets:{defaultValue:null,description:"",name:"selectedAssets",required:!0,type:{name:"string[]"}},setSelectedAssets:{defaultValue:null,description:"",name:"setSelectedAssets",required:!0,type:{name:"Dispatch<SetStateAction<string[]>>"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/generic/AssetSelector/index.tsx#AssetSelector"]={docgenInfo:AssetSelector.__docgenInfo,name:"AssetSelector",path:"src/components/generic/AssetSelector/index.tsx#AssetSelector"})}catch(__react_docgen_typescript_loader_error){}var ContentLayout=__webpack_require__("./src/components/generic/ContentLayout/index.tsx"),LinkedEntityFilter=__webpack_require__("./src/components/generic/LinkedEntityFilter/index.tsx"),STRIDESelector=__webpack_require__("./src/components/generic/STRIDESelector/index.tsx"),TagSelector=__webpack_require__("./src/components/generic/TagSelector/index.tsx"),WorkspaceSelector=__webpack_require__("./src/components/workspaces/WorkspaceSelector/index.tsx"),form_field=__webpack_require__("../../node_modules/@cloudscape-design/components/form-field/index.js"),radio_group=__webpack_require__("../../node_modules/@cloudscape-design/components/radio-group/index.js"),components_select=__webpack_require__("../../node_modules/@cloudscape-design/components/select/index.js"),emotion_react_jsx_runtime_browser_esm=__webpack_require__("../../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const styles={selector:(0,emotion_react_browser_esm.AH)({minWidth:"100px"}),radioGroup:(0,emotion_react_browser_esm.AH)({marginTop:"10px"})},DEFAULT_SORT_BY={field:"Id",ascending:!1},SELECT_OPTIONS=[{label:"Id",value:"Id"},{label:"Priority",value:"Priority"}],SORTING_OPTIONS=[{value:"ascending",label:"Ascending"},{value:"descending",label:"Descending"}],SortByComponent=({value=DEFAULT_SORT_BY,setValue})=>(0,emotion_react_jsx_runtime_browser_esm.FD)(space_between.A,{direction:"horizontal",size:"s",children:[(0,emotion_react_jsx_runtime_browser_esm.Y)("div",{css:styles.selector,children:(0,emotion_react_jsx_runtime_browser_esm.Y)(form_field.A,{label:"Sort by",children:(0,emotion_react_jsx_runtime_browser_esm.Y)(components_select.A,{selectedOption:{label:value.field,value:value.field},onChange:({detail})=>setValue({...value,field:detail.selectedOption.value||DEFAULT_SORT_BY.field}),options:SELECT_OPTIONS,selectedAriaLabel:"Selected"})})}),(0,emotion_react_jsx_runtime_browser_esm.Y)("div",{css:styles.radioGroup,children:(0,emotion_react_jsx_runtime_browser_esm.Y)(radio_group.A,{onChange:({detail})=>setValue({...value,ascending:"ascending"===detail.value}),value:value.ascending?"ascending":"descending",items:SORTING_OPTIONS})})]});SortByComponent.displayName="SortByComponent";const threats_SortBy=SortByComponent;try{SortBy.displayName="SortBy",SortBy.__docgenInfo={description:"",displayName:"SortBy",props:{value:{defaultValue:{value:"{\n  field: 'Id',\n  ascending: false,\n}"},description:"",name:"value",required:!1,type:{name:"SortByOption"}},setValue:{defaultValue:null,description:"",name:"setValue",required:!0,type:{name:"(value: SortByOption) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/threats/SortBy/index.tsx#SortBy"]={docgenInfo:SortBy.__docgenInfo,name:"SortBy",path:"src/components/threats/SortBy/index.tsx#SortBy"})}catch(__react_docgen_typescript_loader_error){}var button_dropdown=__webpack_require__("../../node_modules/@cloudscape-design/components/button-dropdown/index.js"),column_layout=__webpack_require__("../../node_modules/@cloudscape-design/components/column-layout/index.js"),text_content=__webpack_require__("../../node_modules/@cloudscape-design/components/text-content/index.js"),configs_status=__webpack_require__("./src/configs/status.ts"),AssumptionLink=__webpack_require__("./src/components/assumptions/AssumptionLink/index.tsx"),CopyToClipboard=__webpack_require__("./src/components/generic/CopyToClipboard/index.tsx"),GenericCard=__webpack_require__("./src/components/generic/GenericCard/index.tsx"),StatusBadge=__webpack_require__("./src/components/generic/StatusBadge/index.tsx"),MitigationLinksContext_context=__webpack_require__("./src/contexts/MitigationLinksContext/context.ts"),MitigationsContext_context=__webpack_require__("./src/contexts/MitigationsContext/context.ts"),getNewMitigation=__webpack_require__("./src/utils/getNewMitigation/index.tsx"),MitigationLinkView=__webpack_require__("./src/components/mitigations/MitigationLinkView/index.tsx");const MitigationLinkComponent=({linkedEntityId})=>{const{mitigationList,saveMitigation}=(0,MitigationsContext_context.R)(),[mitigationLinks,setMitigationLinks]=(0,react.useState)([]),{getLinkedMitigationLinks}=(0,MitigationLinksContext_context.$)();(0,react.useEffect)((()=>{const _mitigationLinks=getLinkedMitigationLinks(linkedEntityId);setMitigationLinks(_mitigationLinks||[])}),[getLinkedMitigationLinks,linkedEntityId]);const{addMitigationLink,removeMitigationLink}=(0,MitigationLinksContext_context.$)(),handleAddMitigationLink=(0,react.useCallback)((mitigationIdOrNewMitigation=>{if(mitigationList.find((m=>m.id===mitigationIdOrNewMitigation)))addMitigationLink({linkedId:linkedEntityId,mitigationId:mitigationIdOrNewMitigation});else{const newMitigation=saveMitigation((0,getNewMitigation.A)(mitigationIdOrNewMitigation));addMitigationLink({linkedId:linkedEntityId,mitigationId:newMitigation.id})}}),[linkedEntityId,mitigationList,addMitigationLink,saveMitigation]);return(0,jsx_runtime.jsx)(MitigationLinkView.A,{mitigationList,linkedMitigationIds:mitigationLinks.map((ml=>ml.mitigationId)),onAddMitigationLink:handleAddMitigationLink,onRemoveMitigationLink:mitigationId=>removeMitigationLink(mitigationId,linkedEntityId)})};MitigationLinkComponent.displayName="MitigationLinkComponent";const mitigations_MitigationLink=MitigationLinkComponent;try{MitigationLink.displayName="MitigationLink",MitigationLink.__docgenInfo={description:"",displayName:"MitigationLink",props:{linkedEntityId:{defaultValue:null,description:"",name:"linkedEntityId",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/mitigations/MitigationLink/index.tsx#MitigationLink"]={docgenInfo:MitigationLink.__docgenInfo,name:"MitigationLink",path:"src/components/mitigations/MitigationLink/index.tsx#MitigationLink"})}catch(__react_docgen_typescript_loader_error){}var MetadataEditor=__webpack_require__("./src/components/threats/MetadataEditor/index.tsx"),badge=__webpack_require__("../../node_modules/@cloudscape-design/components/badge/index.js"),design_tokens=__webpack_require__("../../node_modules/@cloudscape-design/design-tokens/index.js"),PriorityEdit=__webpack_require__("./src/components/threats/PriorityEdit/index.tsx");const PRIORITY_COLOR_MAPPING={High:"red",Medium:"blue",Low:"green",NoSet:"grey"},PriorityBadge=({editingStatement,onEditMetadata})=>{const ref=(0,react.useRef)(),priority=(0,react.useMemo)((()=>editingStatement.metadata?.find((m=>"Priority"===m.key))?.value||void 0),[editingStatement.metadata]),[editMode,setEditMode]=(0,react.useState)(!1),editor=(0,react.useMemo)((()=>(0,emotion_react_jsx_runtime_browser_esm.Y)(PriorityEdit.A,{ref,showLabel:!1,editingStatement,onEditMetadata,onBlur:()=>setEditMode(!1)})),[editingStatement,onEditMetadata]);return(0,emotion_react_jsx_runtime_browser_esm.Y)("div",{children:editMode?editor:(0,emotion_react_jsx_runtime_browser_esm.Y)("button",{onClick:()=>{setEditMode(!0),setTimeout((()=>ref.current?.focus()),200)},css:emotion_react_browser_esm.AH`
        background: none;
        color: inherit;
        border: none;
        padding: 0;
        paddingBottom: ${design_tokens.M1y};
        font: inherit;
        cursor: pointer;
        outline: inherit;
        verticalAlign: middle;
      `,children:(0,emotion_react_jsx_runtime_browser_esm.Y)(badge.A,{color:PRIORITY_COLOR_MAPPING[priority||"NoSet"]||"grey",children:priority||"Priority Not Set"})})})};PriorityBadge.displayName="PriorityBadge";const threats_PriorityBadge=PriorityBadge;try{PriorityBadge.displayName="PriorityBadge",PriorityBadge.__docgenInfo={description:"",displayName:"PriorityBadge",props:{editingStatement:{defaultValue:null,description:"",name:"editingStatement",required:!0,type:{name:"{ id: string; numericId: number; displayOrder?: number | undefined; tags?: string[] | undefined; threatSource?: string | undefined; prerequisites?: string | undefined; threatAction?: string | undefined; ... 7 more ...; status?: string | undefined; }"}},onEditMetadata:{defaultValue:null,description:"",name:"onEditMetadata",required:!0,type:{name:"(statement: { id: string; numericId: number; displayOrder?: number | undefined; tags?: string[] | undefined; threatSource?: string | undefined; prerequisites?: string | undefined; threatAction?: string | undefined; ... 7 more ...; status?: string | undefined; }, key: string, value: string | ... 1 more ... | undefine..."}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/threats/PriorityBadge/index.tsx#PriorityBadge"]={docgenInfo:PriorityBadge.__docgenInfo,name:"PriorityBadge",path:"src/components/threats/PriorityBadge/index.tsx#PriorityBadge"})}catch(__react_docgen_typescript_loader_error){}const ThreatStatementCard=({showLinkedEntities,statement,onCopy,onRemove,onEditInWizard,onAddTagToStatement,onRemoveTagFromStatement,onEditStatementStatus,onEditMetadata})=>{const handleMoreActions=(0,react.useCallback)((({detail})=>{if("copyToCurrentWorkspace"===detail.id)onCopy?.(statement.id);else console.log("Unknown action",detail.id)}),[onCopy,statement.id]),moreActions=(0,react.useMemo)((()=>(0,emotion_react_jsx_runtime_browser_esm.Y)(button_dropdown.A,{items:[{id:"copyToCurrentWorkspace",text:"Duplicate"}],ariaLabel:"More actions",variant:"icon",onItemClick:handleMoreActions})),[]),displayStatement=(0,react.useMemo)((()=>statement.displayedStatement?statement.displayedStatement.map(((s,index)=>"string"==typeof s?s:"b"===s.type?(0,emotion_react_jsx_runtime_browser_esm.Y)("b",{children:s.content},index):s.content)):statement.statement||""),[statement]);return(0,emotion_react_jsx_runtime_browser_esm.Y)(GenericCard.A,{header:`Threat ${statement.numericId}`,entityId:statement.id,info:(0,emotion_react_jsx_runtime_browser_esm.FD)(space_between.A,{direction:"horizontal",size:"s",children:[(0,emotion_react_jsx_runtime_browser_esm.Y)(StatusBadge.A,{options:threatStatus,setSelectedOption:option=>onEditStatementStatus(statement,option),selectedOption:statement.status,statusColorMapping:configs_status.bd}),(0,emotion_react_jsx_runtime_browser_esm.Y)(threats_PriorityBadge,{editingStatement:statement,onEditMetadata})]}),tags:statement.tags,moreActions,onRemove,onEdit:onEditInWizard,onAddTagToEntity:(_entityId,tag)=>onAddTagToStatement?.(statement,tag),onRemoveTagFromEntity:(_entityId,tag)=>onRemoveTagFromStatement?.(statement,tag),children:(0,emotion_react_jsx_runtime_browser_esm.FD)(space_between.A,{direction:"vertical",size:"s",children:[(0,emotion_react_jsx_runtime_browser_esm.FD)(column_layout.A,{columns:showLinkedEntities?2:1,children:[(0,emotion_react_jsx_runtime_browser_esm.Y)(text_content.A,{children:(0,emotion_react_jsx_runtime_browser_esm.Y)(CopyToClipboard.A,{content:statement.statement,children:displayStatement})}),showLinkedEntities&&(0,emotion_react_jsx_runtime_browser_esm.FD)(space_between.A,{direction:"vertical",size:"s",children:[(0,emotion_react_jsx_runtime_browser_esm.Y)(mitigations_MitigationLink,{linkedEntityId:statement.id}),(0,emotion_react_jsx_runtime_browser_esm.Y)(AssumptionLink.A,{linkedEntityId:statement.id,type:"Threat"})]})]}),(0,emotion_react_jsx_runtime_browser_esm.Y)(MetadataEditor.A,{variant:"default",editingStatement:statement,onEditStatementStatus,onEditMetadata})]})})};ThreatStatementCard.displayName="ThreatStatementCard";const threats_ThreatStatementCard=ThreatStatementCard;try{ThreatStatementCard.displayName="ThreatStatementCard",ThreatStatementCard.__docgenInfo={description:"",displayName:"ThreatStatementCard",props:{showLinkedEntities:{defaultValue:null,description:"",name:"showLinkedEntities",required:!1,type:{name:"boolean"}},statement:{defaultValue:null,description:"",name:"statement",required:!0,type:{name:"{ id: string; numericId: number; displayOrder?: number | undefined; tags?: string[] | undefined; threatSource?: string | undefined; prerequisites?: string | undefined; threatAction?: string | undefined; ... 7 more ...; status?: string | undefined; }"}},onCopy:{defaultValue:null,description:"",name:"onCopy",required:!1,type:{name:"((id: string) => void)"}},onRemove:{defaultValue:null,description:"",name:"onRemove",required:!1,type:{name:"((id: string) => void)"}},onEditInWizard:{defaultValue:null,description:"",name:"onEditInWizard",required:!1,type:{name:"((id: string) => void)"}},onEditStatementStatus:{defaultValue:null,description:"",name:"onEditStatementStatus",required:!0,type:{name:"(statement: { id: string; numericId: number; displayOrder?: number | undefined; tags?: string[] | undefined; threatSource?: string | undefined; prerequisites?: string | undefined; threatAction?: string | undefined; ... 7 more ...; status?: string | undefined; }, status: string) => void"}},onEditMetadata:{defaultValue:null,description:"",name:"onEditMetadata",required:!0,type:{name:"(statement: { id: string; numericId: number; displayOrder?: number | undefined; tags?: string[] | undefined; threatSource?: string | undefined; prerequisites?: string | undefined; threatAction?: string | undefined; ... 7 more ...; status?: string | undefined; }, key: string, value: string | ... 1 more ... | undefine..."}},onAddTagToStatement:{defaultValue:null,description:"",name:"onAddTagToStatement",required:!1,type:{name:"((statement: { id: string; numericId: number; displayOrder?: number; tags?: string[]; threatSource?: string | undefined; prerequisites?: string | undefined; threatAction?: string | undefined; ... 7 more ...; status?: string | undefined; }, tag: string) => void) | undefined"}},onRemoveTagFromStatement:{defaultValue:null,description:"",name:"onRemoveTagFromStatement",required:!1,type:{name:"((statement: { id: string; numericId: number; displayOrder?: number; tags?: string[]; threatSource?: string | undefined; prerequisites?: string | undefined; threatAction?: string | undefined; ... 7 more ...; status?: string | undefined; }, tag: string) => void) | undefined"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/threats/ThreatStatementCard/index.tsx#ThreatStatementCard"]={docgenInfo:ThreatStatementCard.__docgenInfo,name:"ThreatStatementCard",path:"src/components/threats/ThreatStatementCard/index.tsx#ThreatStatementCard"})}catch(__react_docgen_typescript_loader_error){}const LevelOptionsWithNoValue=[...configs.cc,{label:"Priority Not Set",value:configs.gv}],STRIDE_OPTION_NO_VALUE={label:"STRIDE Not Set",value:configs.gv},STRIDEOptionsWithNoValue=[...STRIDESelector.l,STRIDE_OPTION_NO_VALUE],LELEV_MAPPING={High:3,Medium:2,Low:1},ThreatStatementList_styles={btnClearFilter:(0,emotion_react_browser_esm.AH)({height:"100%",display:"flex",alignItems:"flex-start"})},ALL_STATUS=[...threatStatus.map((ia=>({label:ia.label,value:ia.value}))),{label:"Not Set",value:configs.gK}],ThreatStatementList_ContentLayout=({composerMode,children,...props})=>"Full"!==composerMode?(0,emotion_react_jsx_runtime_browser_esm.Y)(emotion_react_jsx_runtime_browser_esm.FK,{children}):(0,emotion_react_jsx_runtime_browser_esm.Y)(ContentLayout.A,{...props,children});ThreatStatementList_ContentLayout.displayName="ContentLayout";const ThreatStatementList=({initialFilter,onThreatEditorView})=>{const{statementList,removeStatement,addStatement,editStatement,saveStatement}=(0,ThreatsContext_context.YN)(),{assumptionLinkList,removeAssumptionLinksByLinkedEntityId}=(0,contexts.NN)(),{mitigationLinkList,removeMitigationLinksByLinkedEntityId}=(0,contexts.$g)(),{showInfoModal,composerMode}=(0,context.$)(),handleRemove=(0,react.useCallback)((async statementId=>{removeStatement(statementId),await removeAssumptionLinksByLinkedEntityId(statementId),await removeMitigationLinksByLinkedEntityId(statementId)}),[removeStatement,removeAssumptionLinksByLinkedEntityId,removeMitigationLinksByLinkedEntityId]),[filteringText,setFilteringText]=(0,react.useState)(""),[sortBy,setSortBy]=(0,react.useState)(DEFAULT_SORT_BY),[selectedImpactedGoal,setSelectedImpactedGoal]=(0,react.useState)([]),[selectedImpactedAssets,setSelectedImpactedAssets]=(0,react.useState)([]),[selectedTags,setSelectedTags]=(0,react.useState)([]),[selectedStatus,setSelectedStatus]=(0,react.useState)(initialFilter?.status||[]),[selectedPriorities,setSelectedPriorities]=(0,react.useState)(initialFilter&&initialFilter.priority?[initialFilter.priority]:[]),[selectedSTRIDEs,setSelectedSTRIDEs]=(0,react.useState)(initialFilter&&initialFilter.stride?[initialFilter.stride]:[]),[selectedLinkedAssumptionFilter,setSelectedLinkedAssumptionFilter]=(0,react.useState)(initialFilter&&void 0!==initialFilter.linkedAssumptions?initialFilter.linkedAssumptions?LinkedEntityFilter.Nf:LinkedEntityFilter.D$:LinkedEntityFilter.y2),[selectedLinkedMitigationFilter,setSelectedLinkedMitigationFilter]=(0,react.useState)(initialFilter&&void 0!==initialFilter.linkedMitigations?initialFilter.linkedMitigations?LinkedEntityFilter.Nf:LinkedEntityFilter.D$:LinkedEntityFilter.y2),handleEditMetadata=(0,useEditMetadata.A)(saveStatement),handleAddTagToStatement=(0,react.useCallback)(((statement,tag)=>{const updatedStatement=(0,entityTag.q)(statement,tag);saveStatement(updatedStatement)}),[saveStatement]),handleRemoveTagFromStatement=(0,react.useCallback)(((statement,tag)=>{const updated=(0,entityTag.A)(statement,tag);saveStatement(updated)}),[]),handleUpdateStatementStatus=(0,react.useCallback)(((statement,status)=>{saveStatement({...statement,status})}),[saveStatement]),filteredStatementList=(0,react.useMemo)((()=>{let output=statementList;return filteringText&&(output=output.filter((st=>st.statement&&st.statement.toLowerCase().indexOf(filteringText.toLowerCase())>=0))),selectedImpactedAssets&&selectedImpactedAssets.length>0&&(output=output.filter((st=>{const tst=st;return tst.impactedAssets?.some((ia=>selectedImpactedAssets.includes(ia)))}))),selectedImpactedGoal&&selectedImpactedGoal.length>0&&(output=output.filter((st=>{const tst=st;return tst.impactedGoal?.some((ia=>selectedImpactedGoal.includes(ia)))}))),selectedTags&&selectedTags.length>0&&(output=output.filter((st=>st.tags?.some((t=>selectedTags.includes(t)))))),selectedStatus&&selectedStatus.length>0&&(output=output.filter((st=>st.status?selectedStatus.includes(st.status):selectedStatus.includes(configs.gK)))),selectedPriorities&&selectedPriorities.length>0&&(output=output.filter((st=>{const priority=st.metadata?.find((m=>"Priority"===m.key));return!(!selectedPriorities.includes(configs.gv)||priority&&priority.value&&0!==priority.value.length)||priority?.value&&selectedPriorities.includes(priority.value)}))),selectedSTRIDEs&&selectedSTRIDEs.length>0&&(output=output.filter((st=>{const stride=st.metadata?.find((m=>"STRIDE"===m.key));return!(!selectedSTRIDEs.includes(configs.gv)||stride&&stride.value&&0!==stride.value.length)||stride?.value&&stride.value.some((t=>selectedSTRIDEs.includes(t)))}))),selectedLinkedAssumptionFilter!==LinkedEntityFilter.y2&&(output=output.filter((st=>assumptionLinkList.some((al=>al.linkedId===st.id))?selectedLinkedAssumptionFilter===LinkedEntityFilter.Nf:selectedLinkedAssumptionFilter===LinkedEntityFilter.D$))),selectedLinkedMitigationFilter!==LinkedEntityFilter.y2&&(output=output.filter((st=>mitigationLinkList.some((al=>al.linkedId===st.id))?selectedLinkedMitigationFilter===LinkedEntityFilter.Nf:selectedLinkedMitigationFilter===LinkedEntityFilter.D$))),output="Priority"===sortBy.field?output.sort(((op1,op2)=>{const priority1=op1.metadata?.find((m=>"Priority"===m.key))?.value,priority2=op2.metadata?.find((m=>"Priority"===m.key))?.value;return(priority2&&LELEV_MAPPING[priority2]||0)-(priority1&&LELEV_MAPPING[priority1]||0)})):output.sort(((op1,op2)=>(op2.numericId||Number.MAX_VALUE)-(op1.numericId||Number.MAX_VALUE))),sortBy.ascending&&(output=output.reverse()),output}),[filteringText,statementList,assumptionLinkList,mitigationLinkList,selectedImpactedAssets,selectedImpactedGoal,selectedTags,selectedStatus,selectedPriorities,selectedSTRIDEs,selectedLinkedAssumptionFilter,selectedLinkedMitigationFilter,sortBy]),hasNoFilter=(0,react.useMemo)((()=>""===filteringText&&0===selectedImpactedAssets.length&&0===selectedImpactedGoal.length&&0===selectedTags.length&&0===selectedStatus.length&&0===selectedPriorities.length&&0===selectedSTRIDEs.length&&selectedLinkedAssumptionFilter===LinkedEntityFilter.y2&&selectedLinkedMitigationFilter===LinkedEntityFilter.y2),[filteringText,selectedImpactedAssets,selectedImpactedGoal,selectedTags,selectedStatus,selectedPriorities,selectedSTRIDEs,selectedLinkedAssumptionFilter,selectedLinkedMitigationFilter]),handleAddStatement=(0,react.useCallback)((idToCopy=>{addStatement(idToCopy),onThreatEditorView?.(configs.TN,idToCopy)}),[addStatement,onThreatEditorView]),handleEditStatement=(0,react.useCallback)((id=>{editStatement(id),onThreatEditorView?.(id)}),[editStatement,onThreatEditorView]),actions=(0,react.useMemo)((()=>(0,emotion_react_jsx_runtime_browser_esm.Y)(emotion_react_jsx_runtime_browser_esm.FK,{children:"Full"!==composerMode?(0,emotion_react_jsx_runtime_browser_esm.Y)(WorkspaceSelector.A,{embededMode:!0,enabledExportAll:statementList.length>0,enabledRemoveAll:statementList.length>0,enabledExportFiltered:!hasNoFilter,filteredThreats:filteredStatementList,children:(0,emotion_react_jsx_runtime_browser_esm.Y)(components_button.A,{variant:"primary",onClick:()=>handleAddStatement(),children:"Add new threat"})}):(0,emotion_react_jsx_runtime_browser_esm.Y)(space_between.A,{direction:"horizontal",size:"s",children:(0,emotion_react_jsx_runtime_browser_esm.Y)(components_button.A,{variant:"primary",onClick:()=>handleAddStatement(),children:"Add new threat"})})})),[filteredStatementList,handleAddStatement,statementList,hasNoFilter,composerMode]),allImpactedGoal=(0,react.useMemo)((()=>statementList.reduce(((all,cur)=>{const statement=cur;return[...all,...statement.impactedGoal?.filter((ig=>!all.includes(ig)))||[]]}),[])),[statementList]),allImpactedAssets=(0,react.useMemo)((()=>statementList.reduce(((all,cur)=>{const statement=cur;return[...all,...statement.impactedAssets?.filter((ia=>!all.includes(ia)))||[]]}),[])),[statementList]),allTags=(0,react.useMemo)((()=>statementList.reduce(((all,cur)=>[...all,...cur.tags?.filter((ia=>!all.includes(ia)))||[]]),[])),[statementList]),handleClearFilter=(0,react.useCallback)((()=>{setFilteringText(""),setSelectedImpactedAssets([]),setSelectedImpactedGoal([]),setSelectedTags([]),setSelectedStatus([]),setSelectedPriorities([]),setSelectedSTRIDEs([]),setSelectedLinkedAssumptionFilter(LinkedEntityFilter.y2),setSelectedLinkedMitigationFilter(LinkedEntityFilter.y2)}),[]),gridDefinition=(0,react.useMemo)((()=>"Full"===composerMode?[{colspan:{default:12,xs:6,s:3}},{colspan:{default:12,xs:6,s:3}},{colspan:{default:12,xs:6,s:3}},{colspan:{default:12,xs:6,s:3}},{colspan:{default:12,xs:6,s:5}},{colspan:{default:12,xs:6,s:5}},{colspan:{default:12,xs:6,s:4}},{colspan:{default:12,xs:6,s:4}},{colspan:{default:12,xs:6,s:4}}]:[{colspan:{default:12,xs:6,s:3}},{colspan:{default:12,xs:6,s:3}},{colspan:{default:12,xs:6,s:3}},{colspan:{default:12,xs:6,s:3}},{colspan:{default:12,xs:6,s:5}},{colspan:{default:12,xs:6,s:5}},{colspan:{default:2}}]),[composerMode]);return(0,emotion_react_jsx_runtime_browser_esm.Y)(ThreatStatementList_ContentLayout,{composerMode,title:"Threats",actions,counter:`(${filteredStatementList.length})`,children:(0,emotion_react_jsx_runtime_browser_esm.FD)(space_between.A,{direction:"vertical",size:"s",children:[(0,emotion_react_jsx_runtime_browser_esm.Y)(container.A,{header:"ThreatsOnly"===composerMode?(0,emotion_react_jsx_runtime_browser_esm.Y)(header.A,{actions,counter:`(${filteredStatementList.length})`,info:(0,emotion_react_jsx_runtime_browser_esm.Y)(components_button.A,{variant:"icon",iconName:"status-info",onClick:showInfoModal}),children:"Threats"}):void 0,children:(0,emotion_react_jsx_runtime_browser_esm.FD)(space_between.A,{direction:"vertical",size:"s",children:[(0,emotion_react_jsx_runtime_browser_esm.Y)(text_filter.A,{filteringText,filteringPlaceholder:"Find threat statements",filteringAriaLabel:"Filter threat statements",onChange:({detail})=>setFilteringText(detail.filteringText)}),(0,emotion_react_jsx_runtime_browser_esm.FD)(grid.A,{gridDefinition,children:[(0,emotion_react_jsx_runtime_browser_esm.Y)(multiselect.A,{tokenLimit:0,selectedOptions:selectedPriorities.map((ia=>({label:ia,value:ia}))),onChange:({detail})=>setSelectedPriorities(detail.selectedOptions?.map((o=>o.value||""))||[]),deselectAriaLabel:e=>`Remove ${e.label}`,options:LevelOptionsWithNoValue,placeholder:"Filtered by priority",selectedAriaLabel:"Selected"}),(0,emotion_react_jsx_runtime_browser_esm.Y)(multiselect.A,{tokenLimit:0,selectedOptions:[...STRIDESelector.l.filter((x=>selectedSTRIDEs.includes(x.value))),...selectedSTRIDEs.includes(configs.gv)?[STRIDE_OPTION_NO_VALUE]:[]],onChange:({detail})=>setSelectedSTRIDEs(detail.selectedOptions?.map((o=>o.value||""))||[]),deselectAriaLabel:e=>`Remove ${e.label}`,options:STRIDEOptionsWithNoValue,placeholder:"Filtered by STRIDE",selectedAriaLabel:"Selected"}),(0,emotion_react_jsx_runtime_browser_esm.Y)(TagSelector.A,{allTags,selectedTags,setSelectedTags}),(0,emotion_react_jsx_runtime_browser_esm.Y)(multiselect.A,{tokenLimit:0,selectedOptions:ALL_STATUS.filter((x=>selectedStatus.includes(x.value))),onChange:({detail})=>setSelectedStatus(detail.selectedOptions?.map((o=>o.value||""))||[]),deselectAriaLabel:e=>`Remove ${e.label}`,options:ALL_STATUS,placeholder:"Filtered by status",selectedAriaLabel:"Selected"}),(0,emotion_react_jsx_runtime_browser_esm.Y)(generic_AssetSelector,{allAssets:allImpactedAssets,selectedAssets:selectedImpactedAssets,setSelectedAssets:setSelectedImpactedAssets}),(0,emotion_react_jsx_runtime_browser_esm.Y)(multiselect.A,{tokenLimit:0,selectedOptions:selectedImpactedGoal.map((ig=>({label:ig,value:ig}))),onChange:({detail})=>setSelectedImpactedGoal(detail.selectedOptions?.map((o=>o.value||""))||[]),deselectAriaLabel:e=>`Remove ${e.label}`,options:allImpactedGoal.map((g=>({label:g,value:g}))),placeholder:"Filtered by impacted goal",selectedAriaLabel:"Selected"}),"Full"===composerMode&&(0,emotion_react_jsx_runtime_browser_esm.Y)(LinkedEntityFilter.Ay,{label:"Linked mitigations",entityDisplayName:"mitigations",selected:selectedLinkedMitigationFilter,setSelected:setSelectedLinkedMitigationFilter}),"Full"===composerMode&&(0,emotion_react_jsx_runtime_browser_esm.Y)(LinkedEntityFilter.Ay,{label:"Linked assumptions",entityDisplayName:"assumptions",selected:selectedLinkedAssumptionFilter,setSelected:setSelectedLinkedAssumptionFilter}),(0,emotion_react_jsx_runtime_browser_esm.Y)("div",{css:ThreatStatementList_styles.btnClearFilter,children:(0,emotion_react_jsx_runtime_browser_esm.Y)("div",{children:(0,emotion_react_jsx_runtime_browser_esm.Y)(components_button.A,{onClick:handleClearFilter,disabled:hasNoFilter,children:"Clear filters"})})})]}),(0,emotion_react_jsx_runtime_browser_esm.Y)(grid.A,{gridDefinition:[{colspan:{default:12,xs:6}}],children:(0,emotion_react_jsx_runtime_browser_esm.Y)(threats_SortBy,{value:sortBy,setValue:setSortBy})})]})}),filteredStatementList?.map((st=>(0,emotion_react_jsx_runtime_browser_esm.Y)(threats_ThreatStatementCard,{statement:st,onCopy:handleAddStatement,onRemove:handleRemove,onEditInWizard:handleEditStatement,onEditMetadata:handleEditMetadata,onEditStatementStatus:handleUpdateStatementStatus,onAddTagToStatement:handleAddTagToStatement,onRemoveTagFromStatement:handleRemoveTagFromStatement,showLinkedEntities:"Full"===composerMode},st.id)))]})})};ThreatStatementList.displayName="ThreatStatementList";const threats_ThreatStatementList=ThreatStatementList;try{ThreatStatementList.displayName="ThreatStatementList",ThreatStatementList.__docgenInfo={description:"",displayName:"ThreatStatementList",props:{initialFilter:{defaultValue:null,description:"",name:"initialFilter",required:!1,type:{name:"ThreatStatementListFilter"}},onThreatEditorView:{defaultValue:null,description:"",name:"onThreatEditorView",required:!1,type:{name:"((threatId: string, idToCopy?: string) => void)"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/threats/ThreatStatementList/index.tsx#ThreatStatementList"]={docgenInfo:ThreatStatementList.__docgenInfo,name:"ThreatStatementList",path:"src/components/threats/ThreatStatementList/index.tsx#ThreatStatementList"})}catch(__react_docgen_typescript_loader_error){}},"./src/components/workspaces/WorkspaceSelector/index.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>workspaces_WorkspaceSelector});var DeleteConfirmationDialog=__webpack_require__("../../node_modules/@aws-northstar/ui/components/DeleteConfirmationDialog/index.js"),components_alert=__webpack_require__("../../node_modules/@cloudscape-design/components/alert/index.js"),components_button=__webpack_require__("../../node_modules/@cloudscape-design/components/button/index.js"),button_dropdown=__webpack_require__("../../node_modules/@cloudscape-design/components/button-dropdown/index.js"),components_select=__webpack_require__("../../node_modules/@cloudscape-design/components/select/index.js"),space_between=__webpack_require__("../../node_modules/@cloudscape-design/components/space-between/index.js"),emotion_react_browser_esm=__webpack_require__("../../node_modules/@emotion/react/dist/emotion-react.browser.esm.js"),react=__webpack_require__("../../node_modules/react/index.js"),configs=__webpack_require__("./src/configs/index.ts"),constants=__webpack_require__("./src/configs/constants.ts"),GlobalSetupContext=__webpack_require__("./src/contexts/GlobalSetupContext/index.tsx"),WorkspaceExamplesContext=__webpack_require__("./src/contexts/WorkspaceExamplesContext/index.tsx"),WorkspacesContext=__webpack_require__("./src/contexts/WorkspacesContext/index.tsx"),contexts=__webpack_require__("./src/contexts/index.ts"),CrossWorkspaceContext=__webpack_require__("./src/contexts/CrossWorkspaceContext/index.tsx"),useExportImport=__webpack_require__("./src/hooks/useExportImport/index.ts");const hooks_useCloneWorkspace=()=>{const{addWorkspace,switchWorkspace}=(0,contexts.Hd)(),{getWorkspaceData}=(0,useExportImport.Ay)(),{cloneWorkspaceData}=(0,CrossWorkspaceContext.W)();return(0,react.useCallback)((async newWorkspaceName=>{const newWorkspace=await addWorkspace(newWorkspaceName),data=await getWorkspaceData();await cloneWorkspaceData(newWorkspace.id,data),switchWorkspace(newWorkspace)}),[addWorkspace,cloneWorkspaceData])};var useRemoveData=__webpack_require__("./src/hooks/useRemoveData/index.ts"),getMobileMediaQuery=__webpack_require__("./src/utils/getMobileMediaQuery/index.tsx"),isWorkspaceExample=__webpack_require__("./src/utils/isWorkspaceExample/index.ts"),icon=__webpack_require__("../../node_modules/@cloudscape-design/components/icon/index.js"),toggle=__webpack_require__("../../node_modules/@cloudscape-design/components/toggle/index.js"),global_styles=__webpack_require__("../../node_modules/@cloudscape-design/global-styles/index.js"),ThemeProvider=__webpack_require__("./src/components/generic/ThemeProvider/index.tsx"),emotion_react_jsx_runtime_browser_esm=__webpack_require__("../../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const styles={svg:(0,emotion_react_browser_esm.AH)({color:"grey !important",fill:"grey !important"})},ThemeToggle=()=>{const{theme,setTheme}=(0,ThemeProvider.wR)();return(0,emotion_react_jsx_runtime_browser_esm.Y)("div",{children:(0,emotion_react_jsx_runtime_browser_esm.FD)(space_between.A,{direction:"horizontal",size:"xs",children:[(0,emotion_react_jsx_runtime_browser_esm.Y)(toggle.A,{onChange:({detail})=>setTheme(detail.checked?global_styles.Kt.Dark:global_styles.Kt.Light),checked:theme===global_styles.Kt.Dark}),(0,emotion_react_jsx_runtime_browser_esm.Y)(icon.A,{svg:(0,emotion_react_jsx_runtime_browser_esm.Y)("svg",{focusable:"false","aria-hidden":"true",viewBox:"0 0 24 24",css:styles.svg,children:(0,emotion_react_jsx_runtime_browser_esm.Y)("path",{d:"M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-2.98 0-5.4-2.42-5.4-5.4 0-1.81.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1"})})})]})})};ThemeToggle.displayName="ThemeToggle";const generic_ThemeToggle=ThemeToggle;var box=__webpack_require__("../../node_modules/@cloudscape-design/components/box/index.js"),form_field=__webpack_require__("../../node_modules/@cloudscape-design/components/form-field/index.js"),header=__webpack_require__("../../node_modules/@cloudscape-design/components/header/index.js"),modal=__webpack_require__("../../node_modules/@cloudscape-design/components/modal/index.js"),customTypes=__webpack_require__("./src/customTypes/index.ts"),Input=__webpack_require__("./src/components/generic/Input/index.tsx"),jsx_runtime=__webpack_require__("../../node_modules/react/jsx-runtime.js");const BUTTON_LABEL={add:"Add",update:"Update",clone:"Clone"},HEADER_TEXT={add:"Add new workspace",update:"Update workspace",clone:"Clone workspace"},EditWorkspace=({visible,setVisible,onConfirm,editMode="add",workspaceList,exampleWorkspaceList,currentWorkspace,...props})=>{const inputRef=(0,react.useRef)(),[value,setValue]=(0,react.useState)(props.value||""),[errorText,setErrorText]=(0,react.useState)("");(0,react.useEffect)((()=>{setErrorText("")}),[value]);const handleConfirm=(0,react.useCallback)((async()=>{setErrorText(""),workspaceList.find((x=>x.name===value&&(!currentWorkspace||currentWorkspace.id!==x.id)))?setErrorText("A workspace already exists with that name"):exampleWorkspaceList.find((x=>x.name===value))?setErrorText("A workspace example already exists with that name"):(await onConfirm(value),setVisible(!1))}),[onConfirm,value,workspaceList,exampleWorkspaceList,currentWorkspace]);(0,react.useEffect)((()=>{inputRef.current?.focus()}),[inputRef.current]);const footer=(0,react.useMemo)((()=>(0,jsx_runtime.jsx)(box.A,{float:"right",children:(0,jsx_runtime.jsxs)(space_between.A,{direction:"horizontal",size:"xs",children:[(0,jsx_runtime.jsx)(components_button.A,{variant:"link",onClick:()=>setVisible(!1),children:"Cancel"}),(0,jsx_runtime.jsx)(components_button.A,{variant:"primary",disabled:value.length<3,onClick:handleConfirm,children:BUTTON_LABEL[editMode]||"Add"})]})})),[setVisible,handleConfirm,value,editMode]);return(0,jsx_runtime.jsx)(modal.A,{header:(0,jsx_runtime.jsx)(header.A,{children:HEADER_TEXT[editMode]||"Add"}),visible,footer,onDismiss:()=>setVisible(!1),children:(0,jsx_runtime.jsx)(space_between.A,{direction:"vertical",size:"m",children:(0,jsx_runtime.jsx)(form_field.A,{label:"New workspace name",errorText,children:(0,jsx_runtime.jsx)(Input.A,{ref:inputRef,value,onChange:({detail})=>setValue(detail.value),validateData:customTypes.x6.shape.name.safeParse})})})})};EditWorkspace.displayName="EditWorkspace";const workspaces_EditWorkspace=EditWorkspace;try{EditWorkspace.displayName="EditWorkspace",EditWorkspace.__docgenInfo={description:"",displayName:"EditWorkspace",props:{visible:{defaultValue:null,description:"",name:"visible",required:!0,type:{name:"boolean"}},setVisible:{defaultValue:null,description:"",name:"setVisible",required:!0,type:{name:"Dispatch<SetStateAction<boolean>>"}},onConfirm:{defaultValue:null,description:"",name:"onConfirm",required:!0,type:{name:"(workspace: string) => Promise<void>"}},value:{defaultValue:null,description:"",name:"value",required:!1,type:{name:"string"}},editMode:{defaultValue:{value:"add"},description:"",name:"editMode",required:!1,type:{name:"enum",value:[{value:'"add"'},{value:'"update"'},{value:'"clone"'}]}},currentWorkspace:{defaultValue:null,description:"",name:"currentWorkspace",required:!1,type:{name:'{ id: string; name: string; storageType?: "LocalState" | "LocalStorage"; metadata?: Record<string, never>; } | undefined'}},workspaceList:{defaultValue:null,description:"",name:"workspaceList",required:!0,type:{name:'{ id: string; name: string; storageType?: "LocalState" | "LocalStorage" | undefined; metadata?: Record<string, never> | undefined; }[]'}},exampleWorkspaceList:{defaultValue:null,description:"",name:"exampleWorkspaceList",required:!0,type:{name:'{ id: string; name: string; storageType?: "LocalState" | "LocalStorage" | undefined; metadata?: Record<string, never> | undefined; }[]'}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/workspaces/EditWorkspace/index.tsx#EditWorkspace"]={docgenInfo:EditWorkspace.__docgenInfo,name:"EditWorkspace",path:"src/components/workspaces/EditWorkspace/index.tsx#EditWorkspace"})}catch(__react_docgen_typescript_loader_error){}var progress_bar=__webpack_require__("../../node_modules/@cloudscape-design/components/progress-bar/index.js"),text_content=__webpack_require__("../../node_modules/@cloudscape-design/components/text-content/index.js"),FileUpload=__webpack_require__("./src/components/generic/FileUpload/index.tsx");const FileImport=({composerMode,visible,setVisible,onImport,onExport,onPreview,onPreviewClose})=>{const[selectedFiles,setSelectedFiles]=(0,react.useState)([]),[data,setData]=(0,react.useState)(),[error,setError]=(0,react.useState)(),[loading,setLoading]=(0,react.useState)(!1),[loadingPercentage,setLoadingPercentage]=(0,react.useState)(0),{parseImportedData}=(0,useExportImport.Ay)(),handleImport=(0,react.useCallback)((files=>{if(setError(""),setData(void 0),setLoading(!0),files.length>0){const file=files[0],reader=new FileReader;reader.addEventListener("load",(event=>{const result=event.target?.result;setError("");try{const importedData=parseImportedData(JSON.parse(result));setData(importedData)}catch(e){setError(e.message)}finally{setLoading(!1)}})),reader.addEventListener("progress",(event=>{if(event.loaded&&event.total){const percent=event.loaded/event.total*100;setLoadingPercentage(percent)}})),reader.readAsText(file)}}),[]),handleConfirmImport=(0,react.useCallback)((()=>{data&&onImport(data),setSelectedFiles([]),setVisible(!1),onPreviewClose?.()}),[onImport,data,onPreviewClose]);(0,react.useEffect)((()=>{selectedFiles&&selectedFiles.length>0&&handleImport(selectedFiles)}),[selectedFiles]);const handlePreview=(0,react.useCallback)((()=>{data&&onPreview?.(data)}),[data]),footer=(0,react.useMemo)((()=>(0,jsx_runtime.jsx)(box.A,{float:"right",children:(0,jsx_runtime.jsxs)(space_between.A,{direction:"horizontal",size:"xs",children:[(0,jsx_runtime.jsx)(components_button.A,{variant:"link",onClick:()=>{setVisible(!1),onPreviewClose?.()},children:"Cancel"}),onPreview&&(0,jsx_runtime.jsx)(components_button.A,{onClick:handlePreview,disabled:!data,children:"Preview"}),(0,jsx_runtime.jsx)(components_button.A,{variant:"primary",disabled:!data,onClick:()=>handleConfirmImport(),children:"Import"})]})})),[setVisible,handleConfirmImport,onPreview,onPreviewClose]);return(0,jsx_runtime.jsx)(modal.A,{visible,footer,onDismiss:()=>{setVisible(!1),onPreviewClose?.()},children:(0,jsx_runtime.jsxs)(space_between.A,{direction:"vertical",size:"m",children:[(0,jsx_runtime.jsx)(components_alert.A,{action:(0,jsx_runtime.jsx)(components_button.A,{onClick:()=>onExport(),children:"Export data"}),statusIconAriaLabel:"Warning",type:"warning",children:(0,jsx_runtime.jsxs)(text_content.A,{children:["Importing data will override all the data in current workspace. This action cannot be undone.",(0,jsx_runtime.jsx)("br",{}),"You can export the data to a json file as backup or create a new ",(0,jsx_runtime.jsx)("b",{children:"workspace"}),"."]})},"override-warning"),(0,jsx_runtime.jsx)(components_alert.A,{statusIconAriaLabel:"Warning",type:"warning",children:(0,jsx_runtime.jsx)(text_content.A,{children:"Only import content from trusted sources."})},"content-warning"),(0,jsx_runtime.jsx)(FileUpload.A,{accept:"application/json",files:selectedFiles,onChange:setSelectedFiles},"fileUpload"),loading&&(0,jsx_runtime.jsx)(progress_bar.A,{value:loadingPercentage,label:"Loading file"},"progress-bar"),error&&(0,jsx_runtime.jsx)(components_alert.A,{statusIconAriaLabel:"Error",type:"error",children:error},"error"),!onPreview&&"Full"!==composerMode&&data&&data.threats&&data.threats.length>0&&(0,jsx_runtime.jsxs)(components_alert.A,{statusIconAriaLabel:"Info",type:"info",children:[data.threats.length," threat statement loaded"]},"info")]})})};FileImport.displayName="FileImport";const workspaces_FileImport=FileImport;try{FileImport.displayName="FileImport",FileImport.__docgenInfo={description:"",displayName:"FileImport",props:{composerMode:{defaultValue:null,description:"",name:"composerMode",required:!0,type:{name:"string"}},visible:{defaultValue:null,description:"",name:"visible",required:!0,type:{name:"boolean"}},setVisible:{defaultValue:null,description:"",name:"setVisible",required:!0,type:{name:"Dispatch<SetStateAction<boolean>>"}},onImport:{defaultValue:null,description:"",name:"onImport",required:!0,type:{name:'(data: { schema: number; workspace?: { id: string; name: string; storageType?: "LocalState" | "LocalStorage" | undefined; metadata?: Record<string, never> | undefined; } | undefined; ... 8 more ...; brainstorm?: { ...; } | undefined; }) => void'}},onExport:{defaultValue:null,description:"",name:"onExport",required:!0,type:{name:"() => void"}},onPreview:{defaultValue:null,description:"",name:"onPreview",required:!1,type:{name:'((data: { schema: number; workspace?: { id: string; name: string; storageType?: "LocalState" | "LocalStorage"; metadata?: Record<string, never>; } | undefined; ... 8 more ...; brainstorm?: { ...; } | undefined; }) => void) | undefined'}},onPreviewClose:{defaultValue:null,description:"",name:"onPreviewClose",required:!1,type:{name:"(() => void)"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/workspaces/FileImport/index.tsx#FileImport"]={docgenInfo:FileImport.__docgenInfo,name:"FileImport",path:"src/components/workspaces/FileImport/index.tsx#FileImport"})}catch(__react_docgen_typescript_loader_error){}const WorkspaceSelector_styles={themeToggle:(0,emotion_react_browser_esm.AH)({height:"100%",display:"flex",alignItems:"center",[(0,getMobileMediaQuery.A)()]:{display:"none"}})},WorkspaceSelector=({embededMode=!0,children,enabledExportAll,enabledExportFiltered,enabledRemoveAll,filteredThreats,singletonMode=!1,singletonPrimaryActionButtonConfig,onPreview,onPreviewClose,onImported})=>{const[addWorkspaceModalVisible,setAddWorkspaceModalVisible]=(0,react.useState)(!1),[editWorkspaceModalVisible,setEditWorkspaceModalVisible]=(0,react.useState)(!1),[cloneWorkspaceModalVisible,setCloneWorkspaceModalVisible]=(0,react.useState)(!1),[removeDataModalVisible,setRemoveDataModalVisible]=(0,react.useState)(!1),[removeWorkspaceModalVisible,setRemoveWorkspaceModalVisible]=(0,react.useState)(!1),[isRemovingWorkspace,setIsRemovingWorkspace]=(0,react.useState)(!1),{workspaceExamples}=(0,WorkspaceExamplesContext.j)(),{importData,exportAll,exportSelectedThreats,getWorkspaceData}=(0,useExportImport.Ay)(),{removeData,deleteWorkspace}=(0,useRemoveData.A)(),{appMode,composerMode,fileImportModalVisible,setFileImportModalVisible}=(0,GlobalSetupContext.$)(),{currentWorkspace,workspaceList,addWorkspace,renameWorkspace,switchWorkspace}=(0,WorkspacesContext.Hd)(),cloneWorkspace=hooks_useCloneWorkspace(),workspacesOptions=(0,react.useMemo)((()=>{const options=[{label:constants.L7,value:constants.AX},{label:constants.XP,options:workspaceExamples.map((we=>({label:we.name,value:we.id})))}];return workspaceList&&workspaceList.length>0&&options.push({label:"Workspaces",options:workspaceList.map((w=>({label:w.name,value:w.id})))}),options}),[workspaceList]),handleSelectWorkspace=(0,react.useCallback)((({detail})=>{const selectedItem=detail.selectedOption;selectedItem.value===constants.AX?switchWorkspace(null):selectedItem.value&&selectedItem.label&&switchWorkspace(selectedItem.value)}),[switchWorkspace]),handleSingletonPrimaryButtonClick=(0,react.useCallback)((()=>{if(singletonPrimaryActionButtonConfig){const data=getWorkspaceData();singletonPrimaryActionButtonConfig.onClick?.(data),singletonPrimaryActionButtonConfig.eventName&&window.threatcomposer.dispatchEvent(new CustomEvent(singletonPrimaryActionButtonConfig.eventName,{detail:data}))}else exportAll()}),[singletonPrimaryActionButtonConfig,getWorkspaceData,exportAll]),handleMoreActions=(0,react.useCallback)((async({detail})=>{switch(detail.id){case"add":setAddWorkspaceModalVisible(!0);break;case"import":setFileImportModalVisible(!0);break;case"clone":setCloneWorkspaceModalVisible(!0);break;case"exportAll":exportAll();break;case"exportFilteredList":exportSelectedThreats(filteredThreats||[]);break;case"removeAll":setRemoveDataModalVisible(!0);break;case"delete":currentWorkspace&&setRemoveWorkspaceModalVisible(!0);break;case"renameWorkspace":setEditWorkspaceModalVisible(!0);break;default:console.log("Unknown action",detail.id)}}),[setFileImportModalVisible,exportAll,exportSelectedThreats,filteredThreats,deleteWorkspace,currentWorkspace,setRemoveDataModalVisible,setRemoveWorkspaceModalVisible,setAddWorkspaceModalVisible,setCloneWorkspaceModalVisible,setEditWorkspaceModalVisible,handleSingletonPrimaryButtonClick]),handleRemoveData=(0,react.useCallback)((async()=>{try{await(removeData?.())}catch(e){console.log("Error in removing data from workspace",e)}finally{setRemoveDataModalVisible(!1)}}),[removeData]),handleDeleteWorkspace=(0,react.useCallback)((async toDeleteWorkspaceId=>{setIsRemovingWorkspace(!0);try{await deleteWorkspace(toDeleteWorkspaceId)}catch(e){console.log("Error in deleting workspace",e)}finally{setRemoveWorkspaceModalVisible(!1),setIsRemovingWorkspace(!1)}}),[]),handleImport=(0,react.useCallback)((async data=>{await importData(data),onImported?.()}),[importData,onImported]),buttonDropdownItems=(0,react.useMemo)((()=>{const items=[];return singletonMode&&singletonPrimaryActionButtonConfig&&appMode!==configs.p$&&items.push({id:"exportAll",text:"Export data"}),singletonMode?items.push({id:"import",text:"Import"}):items.push({id:"add",text:"Add new workspace"},{id:"import",text:"Import into current workspace",disabled:(0,isWorkspaceExample.A)(currentWorkspace?.id)},{id:"clone",text:"Clone current workspace"},{id:"exportAll",text:embededMode?"Export all statements from current workspace":"Export data from current workspace",disabled:embededMode&&!enabledExportAll}),embededMode&&items.push({id:"exportFilteredList",text:"Export filtered statement list from current workspace",disabled:!enabledExportFiltered}),singletonMode?items.push({id:"removeAll",text:"Remove data"}):items.push({id:"removeAll",text:embededMode?"Remove all statements from current workspace":"Remove data from current workspace",disabled:embededMode&&!enabledRemoveAll||(0,isWorkspaceExample.A)(currentWorkspace?.id)}),singletonMode||items.push({id:"delete",text:"Delete workspace",disabled:!currentWorkspace||(0,isWorkspaceExample.A)(currentWorkspace.id)},{id:"renameWorkspace",text:"Rename workspace",disabled:!currentWorkspace||(0,isWorkspaceExample.A)(currentWorkspace.id)}),items}),[appMode,singletonMode,singletonPrimaryActionButtonConfig,embededMode,enabledRemoveAll,enabledExportAll,enabledExportFiltered,currentWorkspace]);return(0,emotion_react_jsx_runtime_browser_esm.FD)(emotion_react_jsx_runtime_browser_esm.FK,{children:[(0,emotion_react_jsx_runtime_browser_esm.FD)(space_between.A,{direction:"horizontal",size:"xs",children:[!singletonMode&&(0,emotion_react_jsx_runtime_browser_esm.Y)(components_select.A,{controlId:"WorkspacesSelect",selectedOption:{value:currentWorkspace?.id||constants.AX,label:`Workspace: ${currentWorkspace?.name||constants.L7}`},options:workspacesOptions,onChange:handleSelectWorkspace}),singletonMode&&(0,emotion_react_jsx_runtime_browser_esm.Y)(components_button.A,{variant:"primary",onClick:handleSingletonPrimaryButtonClick,children:singletonPrimaryActionButtonConfig?singletonPrimaryActionButtonConfig.text:"Export data"}),children,buttonDropdownItems.length>0&&(0,emotion_react_jsx_runtime_browser_esm.Y)(button_dropdown.A,{items:buttonDropdownItems,ariaLabel:"More actions",variant:"icon",onItemClick:handleMoreActions}),"ide-extension"!==appMode&&"Full"===composerMode&&(0,emotion_react_jsx_runtime_browser_esm.Y)("div",{css:WorkspaceSelector_styles.themeToggle,children:(0,emotion_react_jsx_runtime_browser_esm.Y)(generic_ThemeToggle,{})})]}),fileImportModalVisible&&(0,emotion_react_jsx_runtime_browser_esm.Y)(workspaces_FileImport,{composerMode,visible:fileImportModalVisible,setVisible:setFileImportModalVisible,onExport:exportAll,onImport:handleImport,onPreview,onPreviewClose}),addWorkspaceModalVisible&&(0,emotion_react_jsx_runtime_browser_esm.Y)(workspaces_EditWorkspace,{editMode:"add",visible:addWorkspaceModalVisible,setVisible:setAddWorkspaceModalVisible,onConfirm:async workspaceName=>{await addWorkspace(workspaceName)},workspaceList,exampleWorkspaceList:workspaceExamples}),cloneWorkspaceModalVisible&&(0,emotion_react_jsx_runtime_browser_esm.Y)(workspaces_EditWorkspace,{editMode:"clone",visible:cloneWorkspaceModalVisible,setVisible:setCloneWorkspaceModalVisible,onConfirm:async workspaceName=>{await cloneWorkspace(workspaceName)},workspaceList,exampleWorkspaceList:workspaceExamples}),editWorkspaceModalVisible&&currentWorkspace&&(0,emotion_react_jsx_runtime_browser_esm.Y)(workspaces_EditWorkspace,{editMode:"update",visible:editWorkspaceModalVisible,setVisible:setEditWorkspaceModalVisible,value:currentWorkspace.name,onConfirm:newWorkspaceName=>renameWorkspace(currentWorkspace.id,newWorkspaceName),currentWorkspace,workspaceList,exampleWorkspaceList:workspaceExamples}),removeDataModalVisible&&(0,emotion_react_jsx_runtime_browser_esm.Y)(DeleteConfirmationDialog.A,{variant:"friction",visible:removeDataModalVisible,title:"Delete data from current workspace?",onCancelClicked:()=>setRemoveDataModalVisible(!1),onDeleteClicked:handleRemoveData,deleteButtonText:"Remove data",children:(0,emotion_react_jsx_runtime_browser_esm.FD)(components_alert.A,{action:(0,emotion_react_jsx_runtime_browser_esm.Y)(components_button.A,{onClick:()=>exportAll(),children:"Export data"}),type:"warning",children:["Delete"," ",(0,emotion_react_jsx_runtime_browser_esm.FD)("b",{children:["Data from"," ",currentWorkspace?`workspace ${currentWorkspace.name}`:"Default workspace"]})," ","permenantly? This action cannot be undone.",(0,emotion_react_jsx_runtime_browser_esm.Y)("br",{}),"You can export the data to a json file as backup."]})}),removeWorkspaceModalVisible&&currentWorkspace&&(0,emotion_react_jsx_runtime_browser_esm.Y)(DeleteConfirmationDialog.A,{variant:"friction",visible:removeWorkspaceModalVisible,title:"Delete Workspace?",onCancelClicked:()=>setRemoveWorkspaceModalVisible(!1),onDeleteClicked:()=>handleDeleteWorkspace(currentWorkspace.id),loading:isRemovingWorkspace,deleteButtonText:"Delete workspace",children:(0,emotion_react_jsx_runtime_browser_esm.FD)(components_alert.A,{action:(0,emotion_react_jsx_runtime_browser_esm.Y)(components_button.A,{onClick:()=>exportAll(),children:"Export data"}),type:"warning",children:["Delete ",(0,emotion_react_jsx_runtime_browser_esm.FD)("b",{children:["workspace ",currentWorkspace?.name]})," permenantly? All the data inside workspace will be deleted. This action cannot be undone.",(0,emotion_react_jsx_runtime_browser_esm.Y)("br",{}),"You can export the data to a json file as backup."]})})]})},workspaces_WorkspaceSelector=WorkspaceSelector;try{WorkspaceSelector.displayName="WorkspaceSelector",WorkspaceSelector.__docgenInfo={description:"",displayName:"WorkspaceSelector",props:{embededMode:{defaultValue:{value:"true"},description:"",name:"embededMode",required:!1,type:{name:"boolean"}},enabledExportAll:{defaultValue:null,description:"",name:"enabledExportAll",required:!1,type:{name:"boolean"}},enabledRemoveAll:{defaultValue:null,description:"",name:"enabledRemoveAll",required:!1,type:{name:"boolean"}},enabledExportFiltered:{defaultValue:null,description:"",name:"enabledExportFiltered",required:!1,type:{name:"boolean"}},filteredThreats:{defaultValue:null,description:"",name:"filteredThreats",required:!1,type:{name:"{ id: string; numericId: number; displayOrder?: number; tags?: string[]; threatSource?: string | undefined; prerequisites?: string | undefined; threatAction?: string | undefined; ... 7 more ...; status?: string | undefined; }[] | undefined"}},singletonMode:{defaultValue:{value:"false"},description:"",name:"singletonMode",required:!1,type:{name:"boolean"}},singletonPrimaryActionButtonConfig:{defaultValue:null,description:"",name:"singletonPrimaryActionButtonConfig",required:!1,type:{name:'{ text: string; eventName?: string; onClick?: ((data: { schema: number; workspace?: { id: string; name: string; storageType?: "LocalState" | "LocalStorage"; metadata?: Record<...> | undefined; } | undefined; ... 8 more ...; brainstorm?: { ...; } | undefined; }) => void) | undefined; } | undef...'}},onPreview:{defaultValue:null,description:"",name:"onPreview",required:!1,type:{name:'((data: { schema: number; workspace?: { id: string; name: string; storageType?: "LocalState" | "LocalStorage"; metadata?: Record<string, never>; } | undefined; ... 8 more ...; brainstorm?: { ...; } | undefined; }) => void) | undefined'}},onPreviewClose:{defaultValue:null,description:"",name:"onPreviewClose",required:!1,type:{name:"(() => void)"}},onImported:{defaultValue:null,description:"",name:"onImported",required:!1,type:{name:"(() => void)"}},onClone:{defaultValue:null,description:"",name:"onClone",required:!1,type:{name:"(() => Promise<void>)"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/workspaces/WorkspaceSelector/index.tsx#WorkspaceSelector"]={docgenInfo:WorkspaceSelector.__docgenInfo,name:"WorkspaceSelector",path:"src/components/workspaces/WorkspaceSelector/index.tsx#WorkspaceSelector"})}catch(__react_docgen_typescript_loader_error){}}}]);
//# sourceMappingURL=2785.eca143c1.iframe.bundle.js.map